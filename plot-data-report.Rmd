---
title: "Fire-Plant Invasions-TBD Year 1 Report"
output: 
   html_document:
     self_contained: no
     toc: yes
---

```{r set options, echo=F}
# knitr::opts_chunk$set(fig.height = 10)
knitr::opts_chunk$set(fig.width = 7.5)
knitr::opts_chunk$set(dpi = 600)
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
```

```{r load libraries}
# source(plot-data.R)

library(plyr); library(dplyr); library(ggplot2); library(readr)
library(stringi)

```

```{r assign global variables}

def_theme <- theme(legend.title = element_blank(),
            legend.text = element_text(size = 18),
            legend.position = "right",
            axis.text = element_text(size = 18),
            axis.title = element_text(size = 18),
            plot.title = element_text(size = 20)
            )
invasion_color <- scale_color_manual(values = c("darkorange","green4"))
invasion_fill <- scale_fill_manual(values = c("darkorange","green4"))
no_legend_title <- theme(legend.title = element_blank())

```


```{r plot data manipulation}
# plot_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/plot_info.csv")

# plot_locations <- rgdal::readOGR("data/plot-locations.shp", verbose = F)
# plot_data <- plot_locations@data
# plot_data$fire_year <- as.integer(as.character(plot_data$fire_year))
# plot_data$years_since_fire <- 2017 - plot_data$fire_year
# plot_data <- plot_data %>%
#       filter(is.na(fire_year)==FALSE) %>%
#       mutate(plot_id = tolower(stri_sub(name, -2,-1)),
#              installation = tolower(stri_sub(name,1,-3))) %>%
#       rename(last_fire_year = fire_year) %>% 
#       select(installation, plot_id, last_fire_year, years_since_fire, imcy_inv)
# ## Add labels column for installation names
# plot_data$installation_full_name[plot_data$installation=="blanding"] <- "Camp Blanding"
# plot_data$installation_full_name[plot_data$installation=="eglin"] <- "Eglin AFB"
# plot_data$installation_full_name[plot_data$installation=="tyndall"] <- "Tyndall AFB"
# plot_data$installation_full_name[plot_data$installation=="avonpark"] <- "Avon Park AFR"
# plot_data$installation_full_name[plot_data$installation=="shelby"] <- "Camp Shelby"
# plot_data$installation_full_name[plot_data$installation=="moody"] <- "Moody AFB"

plot_data <- read_csv("data/plot_data.csv")
plot_visit_data <- read_csv("data/plot_visit_data.csv")
plot_visit_data <- left_join(plot_visit_data, 
                             select(plot_data, -description, -burn_unit_id))
plot_visit_data <- plot_visit_data[is.na(plot_visit_data$visit_date)==FALSE,]
# plot_visit_data <- arrange(plot_visit_data, desc(ycoord_lat))
# 
# plot_visit_data %>% 
#       if_else(round(ycoord_lat, digits = 1)>31, 31, 0)

```

# Installations Visited and Plots Sampled

* **`r n_distinct(plot_data$installation)` installations**
* **`r n_distinct(plot_data$years_since_fire)` burn units**
* **`r length(plot_data$plot_id)` plots**

```{r summary of plots visited, fig.width=10}

# ggplot(plot_data, aes(installation)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       ggtitle("Number of plots established at each installation") +
#       theme_bw()
# plot_data$inv_colors[plot_data$imcy_inv=="invaded"] <- "#d8b365"
# plot_data$inv_colors[plot_data$imcy_inv=="uninvaded"] <- "#5ab4ac"

ggplot(plot_visit_data, aes(installation_full_name)) +
      geom_bar(fill = "#124873") +
      # facet_grid(installation_full_name ~ ., scales = "free_y") +
      ylab("Number of plots") +
      xlab("") +
      # ggtitle("Plots in Burn Units Across Installations") +
      theme_bw()
      
ggplot(plot_visit_data, aes(as.factor(years_since_fire))) +
      geom_bar(aes(fill = imcy_inv), position = "dodge") +
      invasion_fill +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("Number of plots") +
      xlab("Years since last fire") +
      ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_bw() +
      theme(legend.title = element_blank())

# ggplot(plot_data, aes(imcy_inv)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       xlab("") +
#       ggtitle("Invaded plots: 8, Uninvaded plots: 21") +
#       theme_bw()

ggplot(plot_visit_data, aes(ycoord_lat, years_since_fire)) +
      geom_point(aes(color = installation, shape = imcy_inv), size = 2) +
      # geom_bar(stat = "identity") +
      theme_bw()

```


# Canopy Cover Data
```{r load canopy cover data}
canopy_cover <- read_csv("~/Dropbox (UF)/SERDP-Project/data/densiometer-canopy-cover.csv")

canopy_cover_summary <- canopy_cover %>%
      group_by(installation, plot_id) %>%
      summarise(avg_canopy_cover = mean(pct_canopy_cover),
                sd_canopy_cover = sd(pct_canopy_cover),
                n_obs = 12,
                se_canopy_cover = sd_canopy_cover/sqrt(n_obs))

cc_inv <- left_join(canopy_cover_summary, plot_visit_data)

ggplot(cc_inv, aes(years_since_fire, avg_canopy_cover)) +
      geom_point(aes(color = imcy_inv)) +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      invasion_color +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("% canopy cover") +
      xlab("Years since last fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_bw() +
      theme(legend.title = element_blank())


# plot_data1 <- left_join(ungroup(plot_data), ungroup(canopy_cover_summary))
# plot_data1 <- left_join(ungroup(plot_data), ungroup(quadrat_summaries))
```


# Species Data - 1-meter Quadrats

```{r load 1m quadrat data}
quadrat_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/quadrat1m.csv")
quadrat_data$date <- as.Date(quadrat_data$date, format = "%m/%d/%Y")
quadrat_data <- filter(quadrat_data, date > "2017-06-01")# discard early data collection at Camp Blanding

# summary(quadrat_data)

quadrat_data$woody_veg_ht1[is.na(quadrat_data$woody_veg_ht1)] <- 0
# quadrat_data$woody_veg_ht1 <- as.numeric(quadrat_data$woody_veg_ht1)
quadrat_data$herb_veg_ht1[is.na(quadrat_data$herb_veg_ht1)] <- 0
# quadrat_data$herb_veg_ht1 <- as.numeric(quadrat_data$herb_veg_ht1)
quadrat_data$pct_green[quadrat_data$pct_green=="<1"] <- 0.5
quadrat_data$pct_green <- as.numeric(quadrat_data$pct_green)
```

```{r summarize 1m quadrat data}
quadrat_summaries <- quadrat_data %>%
      group_by(installation, plot_id) %>%
      summarise(
            avg_woody_ht1 = mean(woody_veg_ht1),
            avg_woody_ht_all = mean(
                  c(woody_veg_ht1,woody_veg_ht2,woody_veg_ht3), na.rm = T),
            avg_herb_ht1 = mean(herb_veg_ht1),
            avg_herb_ht_all = mean(c(herb_veg_ht1, herb_veg_ht2, herb_veg_ht3), na.rm = T),
            avg_litter_depth1 = mean(litter_ht1),
            avg_litter_depth_all =
                  mean(c(litter_ht1,litter_ht2,litter_ht3), na.rm = T),
            avg_pct_green = mean(pct_green),
            avg_pct_litter = mean(pct_litter),
            avg_pct_wood = mean(pct_wood_litter),
            avg_pct_bare = mean(pct_bare))

quadrat_summaries <- left_join(
      quadrat_summaries,
      select(plot_data, installation:installation_full_name),
      by = c("installation","plot_id")
)

quadrat10m_summaries <- quadrat_data %>%
      filter(quadrat_id == "n10"|quadrat_id == "e10"|quadrat_id=="s10"|quadrat_id=="w10") %>%
      group_by(installation, plot_id) %>%
      summarise(
            avg_woody_ht1 = mean(woody_veg_ht1),
            avg_woody_ht_all = mean(
                  c(woody_veg_ht1,woody_veg_ht2,woody_veg_ht3), na.rm = T),
            avg_herb_ht1 = mean(herb_veg_ht1),
            avg_herb_ht_all = mean(c(herb_veg_ht1, herb_veg_ht2, herb_veg_ht3), na.rm = T),
            avg_litter_depth1 = mean(litter_ht1),
            avg_litter_depth_all =
                  mean(c(litter_ht1,litter_ht2,litter_ht3), na.rm = T),
            avg_pct_green = mean(pct_green),
            avg_pct_litter = mean(pct_litter),
            avg_pct_wood = mean(pct_wood_litter),
            avg_pct_bare = mean(pct_bare))

# summary(quadrat_summaries)
# summary(quadrat10m_summaries)
```

```{r load species data, results='hide'}
species_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/species1m.csv")
species_data$date <- as.Date(as.character(species_data$date), format = "%Y%m%d")
species_data <- filter(species_data, date>"2017-06-01")
species_data$veg_id <- tolower(species_data$veg_id)
# species_data <- rename(species_data, sci_name = scientific_name)
# length(unique(species_data$veg_id))

species_table <- read_csv("data/plant_species_list.csv")
species_table$species[is.na(species_table$species)] <- ""
species_table$scientific_name <- paste(
      species_table$genus, species_table$species, sep = " ")

species_table %>% arrange(scientific_name)

length(unique(species_data$scientific_name))
sort(unique(species_data$scientific_name))
n_distinct(species_data$veg_id)
sort(unique(species_data$veg_id))


species_data <- left_join(species_data, species_table, 
          by = c("veg_id"="code"))


unique(species_data$scientific_name)
dsub <- select(species_data, veg_id, scientific_name, sci_name, pct_cover) %>% 
      filter(is.na(scientific_name), pct_cover > 10)
sort(unique(dsub$veg_id))


# species_data$scientific_name[species_data$veg_id=="qula"] <- "Quercus laevis"
# species_data$scientific_name[species_data$veg_id=="wiregrass"] <- "Aristida stricta"
# species_data$scientific_name[species_data$veg_id=="limi"] <- "Licania michauxii"
# species_data$scientific_name[species_data$veg_id=="pipa"] <- "Pinus palustris"
# species_data$scientific_name[species_data$veg_id=="quni"] <- "Quercus nigra"
# species_data$scientific_name[species_data$veg_id=="rhco"] <- "Rhus copallinum"
# species_data$scientific_name[species_data$veg_id=="moce"] <- "Morella cerifera"
# species_data$scientific_name[species_data$veg_id=="qula2"] <- "Quercus laurifolia"
# species_data$scientific_name[species_data$veg_id=="quge"] <- "Quercus geminata"
# species_data$scientific_name[species_data$veg_id=="divi"] <- "Diospyros virginiana"
# species_data$scientific_name[species_data$veg_id=="quge"] <- "Quercus geminata"

# filter(species_data, veg_id=="sf" # scientific_name!="NA",
#        )


species_data <- left_join(species_data, plot_visit_data, 
                           by = c("installation","plot_id"))
# summary(species_data)

species_sub <- (filter(species_data, quadrat_id %in% c("e10","w10","n10","s10")))
# length(unique(species_sub$veg_id))
# summary(species_sub)

```



```{r average species cover, fig.height=9}
# datac$se <- datac$sd / sqrt(datac$N)
avg_species_cover <- species_data %>%
             group_by(installation_full_name, plot_id, imcy_inv, years_since_fire, quadrat_id) %>%
      summarise(veg_cover = sum(pct_cover)) %>% 
      ungroup(.) %>% 
      group_by(installation_full_name, plot_id, imcy_inv, years_since_fire) %>%
             summarise(avg_veg_cover = mean(veg_cover),
                       # n_obs = length(veg_id),
                       max_veg_cover = max(veg_cover),
                       se_veg_cover = sd(veg_cover)/sqrt(length(veg_cover)))
ggplot(avg_species_cover,
      aes(as.factor(years_since_fire), avg_veg_cover, fill = imcy_inv)) +
      geom_bar(stat = "identity", position = "dodge") +
      invasion_fill +
      geom_errorbar(aes(ymin = avg_veg_cover + se_veg_cover, ymax = avg_veg_cover - se_veg_cover),
                    width = .2, position=position_dodge(width = .9)) +
      facet_grid(installation_full_name~.) +
      theme_bw() +
      ylab("% Cover") +
      xlab("Years since fire") +
      ggtitle("Average Vegetation Cover Across 1-meter Quadrats") +
      theme(legend.title = element_blank())

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/avg-pct-cover-bars.png", height = 7)
```

```{r species richness, eval=F}
species_over_5pct <- filter(species_data, pct_cover>5)
# species_sub_over_5pct <- filter(species_sub_over_5pct, cogongrass != "NA")

ggplot(species_over_5pct,
       aes(years_since_fire, pct_cover, color = scientific_name)) +
      geom_point(position="jitter") +
      theme_bw() +
      facet_grid(installation~imcy_inv) +
      ylab("% cover") +
      xlab("Years since fire") +
      ggtitle("Range of species cover (>5%) at 1-meter quadrats")
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/species-pct-cover.png", height = 7)



# species_sub <- (filter(species_data2, !quadrat_id %in% c("w2","w4","n2","n4","s2","s4","e2","e4")))
# species_sub_plot <- ggplot(species_sub %>%
#                              filter(pct_cover > 5) %>%
#                              group_by(plot_id, veg_id) %>%
#                              summarise(avg_pct_cover = mean(pct_cover),
#                                        occurrence = length(veg_id)),
#       aes(veg_id,avg_pct_cover, label = occurrence))

# species_sub_plot +
#       geom_bar(stat = "identity") +
#       facet_grid(plot_id ~.) +
#       theme_bw() +
#       ggtitle("12 quadrats per plot")

      # dbh_census_years %>%
      # group_by(sample_year, speciesid, stem_status) %>%
      # summarise(occurrence = length(unique(plotid))) %>%
      # arrange(desc(occurrence))

# head(species_data)

species_richness <- species_data %>%
      group_by(installation, years_since_fire, imcy_inv) %>%
      summarise(richness = length(unique(veg_id))) %>% 
      mutate(ln_richness = log(richness))

invaded_quadrats <- species_data %>% 
      filter(scientific_name=="Imperata cylindrica") %>% 
      mutate(quadrat_invaded = "yes") %>% 
      select(installation:quadrat_id, quadrat_invaded)

species_data <- left_join(species_data, invaded_quadrats)
species_data$quadrat_invaded[is.na(species_data$quadrat_invaded)] <- "no"

quadrat_species_richness <- species_data %>%
      group_by(installation, years_since_fire, quadrat_invaded, quadrat_id) %>%
      summarise(richness = length(unique(veg_id))) %>% 
      mutate(ln_richness = log(richness))
      
ggplot(quadrat_species_richness, aes(installation, richness)) +
      # geom_boxplot(notch = F) +
      geom_point(aes(color = quadrat_invaded), position = "jitter") +
      # geom_smooth(aes(color = imcy_inv), method = "loess") +
      # facet_grid(.~installation) +
      theme_bw()

ggplot(species_data %>%
             filter(pct_cover > 1) %>%
             group_by(installation, years_since_fire, imcy_inv),
       aes(years_since_fire, pct_cover, color = imcy_inv)) +
      geom_point() +
      facet_grid(.~installation) +
      theme_bw()

```

# Tree Data

```{r load tree data}

tree_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/tree-data.csv")
# tree_data
tree_data$date <- as.Date(tree_data$date, format = "%m/%d/%y")

tree_data <- filter(tree_data, date>"2017-06-01", plot_id != "bland03", plot_id != "bland02")  
tree_data$plot_id <- tolower(tree_data$plot_id)

tree_data <- left_join(
      tree_data,
      select(plot_visit_data, -description, -burn_unit_id),
      by = c("installation","plot_id"))

tree_data$species[tree_data$species=="divi5"] <- "divi"
# tree_data$genus <- tree_data$species

tree_data$genus[tree_data$species=="divi"] <- "Diospyros"
tree_data$genus[tree_data$species=="cr"] <- "Crataegus"
tree_data$genus[tree_data$species=="acru"] <- "Acer"
tree_data$genus[tree_data$species=="sweetgum"] <- "Liquidambar"
tree_data$genus[agrep("qu", tree_data$species, max.distance = 0)] <- "Quercus"
tree_data$genus[agrep("pi", tree_data$species, max.distance = 0)] <- "Pinus"
tree_data$genus[is.na(tree_data$species)] <- "Unknown (dead)"
tree_data$labels <- tree_data$genus
tree_data$labels[!(tree_data$labels %in% c("Quercus","Pinus"))] <- "Other"

```

```{r plot tree data, fig.height=9}

tree_richness <- tree_data %>% 
      group_by(installation_full_name, years_since_fire, imcy_inv) %>% 
      summarise(richness = n_distinct(species))
ggplot(tree_richness, aes(years_since_fire, richness, color = imcy_inv)) +
      geom_point() +
      invasion_color +
      # facet_grid(installation_full_name~.) +
      theme_bw()

ggplot(tree_data %>%
             group_by(installation_full_name, labels, years_since_fire) %>%
             mutate(basal_area = pi*((.5*dbh/100)^2)) %>% 
             summarise(total_basal_area = sum(basal_area),
                       avg_basal_area = mean(basal_area),
                       se_basal_area = sd(basal_area)/sqrt(length(basal_area))),
       aes(as.factor(years_since_fire), total_basal_area)
      ) +
      geom_bar(aes(fill = labels), stat = "identity", position = "dodge") +
      # geom_errorbar(aes(ymin = total_basal_area + se_veg_cover, ymax = avg_veg_cover - se_veg_cover), width = .2, position=position_dodge(width = .9)) +
      scale_fill_brewer(palette = "Dark2") +
      facet_grid(installation_full_name~.) +
      theme_bw() +
      xlab("Years since fire") +
      ylab(expression(paste("Basal Area (", m^{2}, ")"))) +
      no_legend_title


ggplot(tree_data %>%
             group_by(installation_full_name, labels, years_since_fire, imcy_inv),
       aes(as.factor(years_since_fire), dbh, color = labels)) +
      geom_point(position = "jitter") +
      scale_fill_brewer(palette = "Dark2") +
      facet_grid(installation_full_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Diameter at breast height") +
      no_legend_title
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-dbh-jitter.png", height=7)


ggplot(tree_data %>%
             group_by(installation_full_name, labels, years_since_fire, imcy_inv),
       aes(years_since_fire, height, color = labels)) +
      geom_point(position = "jitter") +
      scale_fill_brewer(palette = "Dark2") +
      facet_grid(installation_full_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Tree height") +
      no_legend_title
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-height-jitter.png", height=7)

```

# Biomass data sampled at 25cm quadrats

```{r 25cm biomass data}
biomass_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/quadrat25cm.csv")
biomass_data$date <- as.Date(biomass_data$date, format="%m/%d/%y")
biomass_data <- filter(biomass_data, date>"2017-04-25", plot_id!="bland02", plot_id!="bland03")
# summary(biomass_data)
biomass_data$standing_fuel_mass_wet <- round(
      biomass_data$standing_fuel_mass_wet, 2)

biomass_data <- left_join(
      select(biomass_data, installation, plot_id, standing_fuel_ht:standing_biomass_type),
      select(plot_data, installation:installation_full_name),
      by = c("installation","plot_id")) %>% 
      mutate(pct_std_moisture = 
                   100*(standing_fuel_mass_wet - standing_fuel_mass_dry)/standing_fuel_mass_wet,
             pct_lit_moisture = 
                   100*(litter_mass_wet - litter_mass_dry)/litter_mass_wet)

# biomass_data$last_fire_year <- as.integer(biomass_data$last_fire_year)
# biomass_data$years_since_fire <- 2017 - biomass_data$last_fire_year

avg_biomass_data <- biomass_data %>% 
      group_by(installation, plot_id, years_since_fire) %>% 
      mutate(standing_gm2 = standing_fuel_mass_wet*16,
             litter_gm2 = litter_mass_wet*16) %>% 
      summarise(avg_standing_gm2 = mean(standing_gm2),
                avg_litter_gm2 = mean(litter_gm2),
                se_standing = sd(standing_gm2)/sqrt(length(standing_gm2)),
                se_litter = sd(litter_gm2)/sqrt(length(litter_gm2)))

ggplot(biomass_data,
       aes(years_since_fire, (standing_fuel_mass_wet*16))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      # facet_grid(.~installation) +
      geom_smooth(aes(color = imcy_inv), method = "loess", se = F) +
      theme_bw() +
      ylab(expression(paste("Standing biomass (g/", m^{2}, ")"))) +
      xlab("Years since last fire") +
      ggtitle("Fresh standing biomass across burn units at each installation",
              subtitle = "(measurements at 25cm quadrats)") +
      theme(legend.title = element_blank())
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/standing-biomass-hitter.png", height=7)

ggplot(biomass_data,
        aes((years_since_fire), litter_mass_wet*16)) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      # facet_grid(.~installation) +
      theme_bw() +
      ylab(expression(paste("Litter biomass (g/", m^{2}, ")"))) +
      xlab("Years since last fire") +
      ggtitle("Fresh litter biomass across burn units",
              subtitle = "(measurements at 25cm quadrats)")
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/litter-biomass-jitter.png", height=7)
```


# Host Abundance Estimates

```{r dung data}

dung_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/dung.csv")
dung_data$plot_id <- tolower(dung_data$plot_id)
dung_data$Species <- tolower(dung_data$Species)
dung_data$Location <- tolower(dung_data$Location)
dung_data <- rename(dung_data, clusters1m = `1m`, clusters2m = `2m`)
dung_data_avg <- dung_data %>% 
      group_by(installation, plot_id) %>% 
      summarise(avg_clusters1m = mean(clusters1m))
dung_data_avg <- left_join(dung_data_avg, plot_visit_data)
```

```{r dung-fire-plot}

ggplot(dung_data_avg, 
       aes((years_since_fire), (avg_clusters1m))) +
      geom_point(aes(color = imcy_inv), size = 2) +
      invasion_color +
      geom_smooth(method = "loess", se = F) +
      # geom_bar(aes(fill = installation), stat = "identity", position = "dodge") +
      theme_bw() +
      xlab("Years since fire") +
      # ylab("Dung clusters") +
      def_theme

```


# Tick Abundance Estimates

```{r tick data QC}

tick_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/ticks.csv")

tick_data$plot_id <- tolower(tick_data$plot_id)
tick_data$plot_id[tick_data$plot_id=="c"] <- "c1"
# tick_data$Date <- as.Date(tick_data$Date, format = "%Y-%m-%d-")
tick_data$excel_date <- gsub("-","",tick_data$date)
write_csv(tick_data, "data/tick-data.csv")

tick_data <- left_join(tick_data, plot_visit_data, 
                       by = c("installation", "plot_id"))
# summary(tick_data)
# filter(tick_data, is.na(years_since_fire))
# "extra" ticks at Moody AFB were from an area last burned in 2005
tick_data$years_since_fire[tick_data$installation=="moody"] <- 2017-2005
tick_data <- tick_data[is.na(tick_data$years_since_fire)==FALSE,]
tick_data$installation_full_name[tick_data$installation=="moody"] <- "Moody AFB"

```


The high tick abundance for 8-years post-fire is driven by a single plot at Camp Blanding.

```{r tick-abundance-fire-summary}

ggplot(tick_data %>%
             group_by(years_since_fire) %>%
             summarise(tick_number = sum(count)),
       aes(as.factor(years_since_fire), tick_number)) +
      # geom_point(position = "jitter") +
      geom_bar(fill = "#124873", stat = "identity", position = "dodge") +
      # facet_grid(installation~., scales = "free_y") +
      xlab("Years since fire") +
      ylab("Tick abundance") +
      theme_bw() +
      theme(axis.text = element_text(size = 18),
            axis.title = element_text(size = 22))

```


```{r tick-abundance-by-date}

tick_data$week <- lubridate::week((tick_data$Date))
ggplot(tick_data %>% 
             group_by(Date, installation_full_name) %>% 
             summarise(abundance = sum(count)),
       aes(Date, abundance)) +
      # geom_point(aes(color = installation), size = 2) +
      geom_bar(aes(fill = installation_full_name), stat = "identity") +
      scale_fill_brewer(type = "div") +
      scale_x_date() +
      # geom_smooth() +
      theme_bw() +
      ylab("Tick abundance") +
      xlab("") +
      theme(axis.text = element_text(size = 18),
            axis.title = element_text(size = 22),
            legend.title = element_blank(),
            legend.text = element_text(size = 11),
            legend.position = c(.85,.8),
            legend.background = element_rect(color="black"))
      
```


**Note the different scales of the y-axes on these plots**

```{r plot tick species data, fig.height=9}
ggplot(tick_data %>%
             group_by(installation_full_name, years_since_fire, Species) %>%
             summarise(tick_number = sum(count)),
       aes(as.factor(years_since_fire), tick_number, fill = Species)) +
      # geom_point(position = "jitter") +
      geom_bar(stat = "identity", position = "dodge") +
      facet_grid(installation_full_name~., scales = "free_y") +
      xlab("Years since fire") +
      ylab("Tick abundance") +
      theme_bw() +
      theme(axis.text = element_text(size = 18),
            axis.title = element_text(size = 22))
```

```{r summarize-tick-abundance-data}
tick_data_sum <- tick_data %>% 
      group_by(installation, plot_id, installation_full_name, years_since_fire) %>% 
      summarise(total_ticks = sum(count))
biomass_data_sub <- ungroup(avg_biomass_data) %>% 
      select(installation:avg_litter_gm2)

# plot_data
d1 <- left_join(plot_data, tick_data_sum)
d1$total_ticks[is.na(d1$total_ticks)] <- 0
d1 <- left_join(d1, biomass_data_sub)
d1 <- left_join(d1, select(avg_species_cover, installation_full_name:max_veg_cover))
d1 <- left_join(d1, quadrat_summaries)
d1 <- left_join(d1, 
                select(canopy_cover_summary, installation:avg_canopy_cover)
                )
d1 <- left_join(d1, select(dung_data_avg, installation:avg_clusters1m))

```

```{r tick-abundance-latitude}

ggplot(d1, aes(ycoord_lat, log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv), position = "jitter") +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      # geom_smooth(aes(color = imcy_inv), method = "loess", 
                  # linetype = "dashed", se = F) +
      theme_bw() +
      xlab("Latitude") +
      ylab("Tick Abundance (ln)") +
      def_theme

```

```{r tick-fire}

ggplot(d1, aes(years_since_fire, log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv), position = "jitter") +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = T) +
      # geom_smooth(aes(color = imcy_inv), method = "loess", 
                  # linetype = "dashed", se = F) +
      theme_bw() +
      xlab("Years Since Fire") +
      ylab("Tick Abundance (ln)") +
      def_theme

```

```{r tick-veg-cover}

ggplot(d1, aes(avg_veg_cover, log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv), position = "jitter") +
      invasion_color +
      geom_smooth(aes(color = imcy_inv) , method = "lm", se = T) +
      # geom_smooth(aes(color = imcy_inv), method = "loess", 
                  # linetype = "dashed", se = F) +
      theme_bw() +
      xlab("Average Vegetation Cover (%)") +
      ylab("Tick Abundance (ln)") +
      def_theme

```

```{r tick-veg-biomass}

ggplot(d1, aes((avg_standing_gm2), log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      theme_bw() +
      xlab(expression(paste("Average Biomass (g/", m^{2}, ")"))) +
      ylab("Tick Abundance (ln)") +
      ggtitle("Understory standing biomass") +
      def_theme

```

```{r tick-litter-cover}

ggplot(d1, aes(avg_pct_litter, log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv), position = "jitter") +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      theme_bw() +
      xlab(expression(paste("Average Litter Cover (%)"))) +
      ylab("Tick Abundance (ln)") +
      def_theme

```

```{r tick-litter-mass}

ggplot(d1, aes(avg_litter_gm2, log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv), position = "jitter") +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      theme_bw() +
      xlab(expression(paste("Average Biomass (g/", m^{2}, ")"))) +
      ylab("Tick Abundance (ln)") +
      ggtitle("Litter Biomass") +
      def_theme

```

```{r tick-canopy-cover}

ggplot(d1, aes(avg_canopy_cover, log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      theme_bw() +
      xlab(expression(paste("Average Canopy Cover (%)"))) +
      ylab("Tick Abundance (ln)") +
      def_theme

```

```{r tick-hosts}

ggplot(d1, aes(log1p(avg_clusters1m), log1p(total_ticks))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(method = "loess", se = F) +
      theme_bw() +
      xlab(expression(paste("Average # of dung clusters (0-1m)"))) +
      ylab("Tick Abundance (ln)") +
      def_theme

```

```{r hosts-canopy-cover}

 ggplot(d1, aes(avg_canopy_cover, avg_clusters1m)) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      theme_bw() +
      xlab(expression(paste("Average Canopy Cover (%)"))) +
      ylab("Dung clusters (1m)") +
      def_theme

```


Summary of linear models between some of the variables plotted above.
```{r linear models ticks}
summary(lm(log1p(total_ticks) ~ years_since_fire, data = d1))
summary(lm(log1p(total_ticks) ~ avg_litter_gm2, data = d1))
summary(lm(avg_litter_gm2 ~ years_since_fire, data = d1))
summary(lm(log1p(total_ticks) ~ avg_canopy_cover, data = d1))
```


# Cogongrass Data Sampled from Invasions

```{r cogongrass data, eval=T}
cogon_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/cogon-data.csv")
cogon_biomass <- cogon_data %>%
      # select(site,plot_id,Quad,fresh_biomass) %>%
      filter(site!="NA") %>%
      mutate(biomass=fresh_biomass*16)
cogon_biomass <- left_join(
      cogon_biomass,
      select(plot_data, installation,plot_id,years_since_fire),
      by=c("site"="installation","plot_id"))
ggplot(cogon_biomass, aes(years_since_fire, biomass)) +
      geom_point(aes(color = site)) +
      theme_bw() +
      xlab("Years since fire") +
      ylab(expression(paste("Standing biomass fresh weight (g/", m^{2}, ")"))) +
      ggtitle("Cogongrass Invasions Biomass")
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/cogon-biomass.png", height = 7)
```

Maximum cogongrass biomass estimated from 25cm quadrat samples from invasions at DoD installations: `r max(cogon_biomass$biomass)`g/m^2^


# Compare All Quadrat Data to Subset of Data

Percent cover

 * litter
 * bare ground
 * green

Heights

 * woody vegetation (3 measurements)
 * grassy/herbaceous vegetation (3 measurements)
 * litter (depth)
 
* If there was no vegetation or litter height to measure then the first vegetation measurement was assigned a value of zero and the other two `r NA`.


We (Drew and I) have been talking about the possibility of further reducing the amount of effort expended to sample vegetation and set up the plot by revising the plot design. 

**The alternative:** We use the 12.6m circular plot with just four vegetation sampling quadrats at 10 meters. Tick traps would be placed near the outside edge of the plot in each of the cardinal directions (north, east, south, west), and one in plot center.

**The caveats:** 1. Tick trap deployment and vegetation measurements would have to be on different days. 2. We still need to do transects for dung surveys.

My first step was to see how this plays out in the data by testing for differences in means of data summarized across all quadrats (12) to data from the quadrats at 10 meters (4). I subset the data and conducted a series of t-test on the means (averaging across all the 1 meter quadrats in each data set) of woody vegetation height, herbaceous vegetation height, litter depth; and percent covers of bare ground, green vegetation, and litter. 


```{r compare all 12 quadrats to subset of 4 at 10m }
par(mfrow=c(1,2))
hist(log(quadrat_summaries$avg_woody_ht1))
hist(log(quadrat10m_summaries$avg_woody_ht1))
t.test(log(quadrat_summaries$avg_woody_ht1),log(quadrat10m_summaries$avg_woody_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_woody_ht_all))
var(log(quadrat_summaries$avg_woody_ht_all))
hist(log(quadrat10m_summaries$avg_woody_ht_all))
var(log(quadrat10m_summaries$avg_woody_ht_all))
t.test(log(quadrat_summaries$avg_woody_ht_all),log(quadrat10m_summaries$avg_woody_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht1))
var(log(quadrat_summaries$avg_herb_ht1))
hist(log(quadrat10m_summaries$avg_herb_ht1))
var(log(quadrat10m_summaries$avg_herb_ht1))
t.test(log(quadrat_summaries$avg_herb_ht1),
       log(quadrat10m_summaries$avg_herb_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht_all))
var(log(quadrat_summaries$avg_herb_ht_all))
hist(log(quadrat10m_summaries$avg_herb_ht_all))
var(log(quadrat10m_summaries$avg_herb_ht_all))
t.test(log(quadrat_summaries$avg_herb_ht_all),
       log(quadrat10m_summaries$avg_herb_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth1))
var(log(quadrat_summaries$avg_litter_depth1))
hist(log(quadrat10m_summaries$avg_litter_depth1))
var(log(quadrat10m_summaries$avg_litter_depth1))
t.test(log(quadrat_summaries$avg_litter_depth1),
       log(quadrat10m_summaries$avg_litter_depth1), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth_all))
var(log(quadrat_summaries$avg_litter_depth_all))
hist(log(quadrat10m_summaries$avg_litter_depth_all))
var(log(quadrat10m_summaries$avg_litter_depth_all))
t.test(log(quadrat_summaries$avg_litter_depth_all),
       log(quadrat10m_summaries$avg_litter_depth_all), var.equal = T)

hist((quadrat_summaries$avg_pct_green))
var((quadrat_summaries$avg_pct_green))
hist((quadrat10m_summaries$avg_pct_green))
var((quadrat10m_summaries$avg_pct_green))
t.test((quadrat_summaries$avg_pct_green),
       (quadrat10m_summaries$avg_pct_green), var.equal = F)

hist(log(quadrat_summaries$avg_pct_litter))
var(log(quadrat_summaries$avg_pct_litter))
hist(log(quadrat10m_summaries$avg_pct_litter))
var(log(quadrat10m_summaries$avg_pct_litter))
t.test(log(quadrat_summaries$avg_pct_litter),
       log(quadrat10m_summaries$avg_pct_litter), var.equal = F)

hist(log1p(quadrat_summaries$avg_pct_bare))
var((quadrat_summaries$avg_pct_bare))
hist(log1p(quadrat10m_summaries$avg_pct_bare))
var((quadrat10m_summaries$avg_pct_bare))
t.test(log1p(quadrat_summaries$avg_pct_bare),
       log1p(quadrat10m_summaries$avg_pct_bare), var.equal = F)
```

Using all 12 qudrats we have `r n_distinct(species_data$veg_id)` species, while using the four quadrats at 10 meters we have `r n_distinct(species_sub$veg_id)` species. This suggests a major difference in species richness, however, some of these are as yet unidentified/grouped and are likely duplicates for both data sets. 

```{r t-test species cover quadrat subset}
## Testing for differences in dense vs. less dense data collection
hist(log(species_data$pct_cover))
var(log(species_data$pct_cover))
hist(log(species_sub$pct_cover))
var(log(species_sub$pct_cover))
t.test(log(species_data$pct_cover), log(species_sub$pct_cover),
       var.equal = T, paired = F)
```
A t-test of the log-transformed means for percent cover indicate no statistical difference.

Based on these t-tests there were no statistical differences in the means of these variables aggregated to the plot level. 
