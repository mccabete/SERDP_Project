---
title: "Fire-Plant Invasions-TBD"
output:
  html_document:
    self_contained: no
    toc: yes
  pdf_document:
    toc: yes
date: "`r Sys.Date()`"
---

```{r set options, echo=F}
# knitr::opts_chunk$set(fig.height = 10)
knitr::opts_chunk$set(fig.width = 7.5)
knitr::opts_chunk$set(dpi = 300)
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
```

```{r load libraries}
# source(plot-data.R)

library(plyr); library(dplyr); library(ggplot2); library(readr)
library(stringi); library(stringr)
library(tidyr)
library(viridisLite); library(viridis)

rm(list=ls())

```

```{r assign global variables}

def_theme <- theme(legend.title = element_blank(),
            legend.text = element_text(size = 12),
            legend.position = "top",
            legend.direction = "vertical",
            axis.text = element_text(size = 14),
            axis.title = element_text(size = 16),
            plot.title = element_text(size = 18),
            strip.background = element_blank(),
            panel.grid = element_blank()
            )
invasion_color <- scale_color_viridis_d(end = .98)
invasion_fill <- scale_fill_viridis_d(end = .98)

```

```{r read in plot data, echo=F, results='hide'}
# Check source R script if needed: 'plot-data-qaqc.R'
# source("R_scripts/plot-data-qaqc.R")

plot_visit_data <- read_csv("data/processed_data/plot_visit_data.csv")
# summary(plot_visit_data)
# sort(unique(plot_visit_data$plot_id))
# filter(plot_visit_data, is.na(years_since_fire))

# There should be 104 records, 29 in visit year 2017 and 75 in 2018.
# filter(plot_visit_data, visit_year==2017)
# filter(plot_visit_data, visit_year==2018)

plot_visit_data$imcy_inv <- factor(plot_visit_data$imcy_inv, levels=c("uninvaded","invaded"), labels = c("Uninvaded","Invaded"))

```

There are 3 `NA` values in the coarse fire history columns. The `NA`s correspond to the odd/extra cogongrass plot that we sampled at Camp Blanding and 2 plots at Camp Shelby that I (WD) have requested data for as of 9/6/2018.


# Installations Visited and Plots Sampled

* **`r n_distinct(plot_visit_data$installation)` installations**
* **`r n_distinct(plot_visit_data$years_since_fire)` different years since fire**
* **`r n_distinct(plot_visit_data$plot_id)` different plots, some multiple times**
* **`r length(plot_visit_data$plot_id)` plot visits (some revisits)**

```{r make installation map, echo=F, results='hide'}

library(rgdal); library(sp); library(maptools)
installations <- rgdal::readOGR("data/selected_installations.shp", verbose = F)
summary(installations)
# installations$FULLNAME
# bases <- c("Tyndall AFB","Ft. Benning","Camp Blanding","Ft. Jackson","Eglin AFB","Ft. Gordon","Camp Shelby","Avon Park AFR","Moody AFB")
# length(bases)
# installations <- installations[installations$FULLNAME%in%bases,]
# summary(installations)
# plot(installations, col = installations$FULLNAME)

```


![](figures/Year2bases.png)

```{r summary of plots visited, fig.height=5}

# xtabs(~ imcy_inv + last_fire_year + installation_full_name, data = plot_visit_data)

# ggplot(plot_data, aes(installation)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       ggtitle("Number of plots established at each installation") +
#       theme_classic()
# plot_data$inv_colors[plot_data$imcy_inv=="invaded"] <- "#d8b365"
# plot_data$inv_colors[plot_data$imcy_inv=="uninvaded"] <- "#5ab4ac"

plot_nums <- plot_visit_data %>%
      group_by(installation_full_name, imcy_inv) %>% 
      summarise(plot_ct = n_distinct(plot_id))
plot_nums %>%       
      ggplot(aes(installation_full_name, plot_ct, label=plot_ct)) +
      geom_col(aes(fill = imcy_inv)) +
      invasion_fill +
      # geom_text(nudge_y = 0) +
      # scale_fill_manual(values = c(installation_name = "blue")) +
      # facet_grid(installation_full_name ~ ., scales = "free_y") +
      ylab("Number of sample plots") +
      xlab("") +
      # ggtitle("Plots in Burn Units Across Installations") +
      theme_classic() +
      def_theme +
      # theme(lege) +
      NULL

plot_visit_data %>% 
      filter(!is.na(years_since_fire)) %>%
      ggplot(aes(as.factor(years_since_fire))) +
      geom_bar(aes(fill = imcy_inv), position = "dodge") +
      invasion_fill +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("Number of plots") +
      xlab("Years since fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      def_theme +
      theme(legend.position = c(.8,.9)) +
      NULL

# ggplot(plot_data, aes(imcy_inv)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       xlab("") +
#       ggtitle("Invaded plots: 8, Uninvaded plots: 21") +
#       theme_classic()

# ggplot(plot_visit_data, aes(ycoord_lat, years_since_fire)) +
#       geom_point(aes(color = installation, shape = imcy_inv), size = 2) +
#       # geom_bar(stat = "identity") +
#       theme_classic()

```

```{r fire invasion by installation, fig.height=10}

plot_visit_data %>% 
      filter(!is.na(years_since_fire)) %>%
      ggplot(aes(as.factor(years_since_fire))) +
      geom_bar(aes(fill = imcy_inv), position = "dodge") +
      invasion_fill +
      facet_grid(installation_full_name~.) +
      ylab("Number of sample points") +
      xlab("Years since fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_bw() +
      def_theme +
      NULL

```


We made 104 plot visits, therefore there should for the most part be 104 observations for all data summarized to the plot level. One exception I can think of is that we didn't do tick sampling at the 'blanding theater_cogon' plot.

# Canopy Cover Data
```{r load canopy cover data}

canopy_cover <- read_csv("data/processed_data/canopy-cover.csv")
canopy_cover <- canopy_cover %>% 
      mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
             visit_year = lubridate::year(date))
cc_plot_data <- left_join(
      canopy_cover %>% 
            filter(distance == 10) %>% 
            select(-distance,-fill_dots), 
      select(plot_visit_data, -notes))

canopy_cover_summary <- cc_plot_data %>%
      group_by(installation, plot_id, visit_year, imcy_inv, years_since_fire) %>%
      summarise(avg_canopy_cover = mean(pct_canopy_cover),
                sd_canopy_cover = sd(pct_canopy_cover),
                n_obs = length(pct_canopy_cover),
                se_canopy_cover = sd_canopy_cover/sqrt(n_obs))
# summary(canopy_cover_summary)

# summary(cc_inv)
# cc_inv <- filter(cc_inv, !is.na(years_since_fire))

```


```{r canopy-cover-fire-figure}

ggplot(canopy_cover_summary, aes(years_since_fire, avg_canopy_cover)) +
      geom_point(aes(color = imcy_inv)) +
      # geom_smooth(aes(color = imcy_inv), method = "loess", alpha = .2, linetype = "dashed", se = F) +
      geom_smooth(aes(fill = imcy_inv, color = imcy_inv), method = "lm", alpha = .3) +
      # geom_smooth(method = "lm", linetype = "dashed", color = "gray50") +
      invasion_color +
      invasion_fill +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("Overstory canopy cover (%)") +
      xlab("Years since last fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      def_theme +
      theme(legend.title = element_blank())
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/canopy-cover-fire.png", height = 7.5, width = 7.5)

```

```{r canopy-cover-vs-fire-model}

cc_fire_mod <- lm(avg_canopy_cover ~ years_since_fire + imcy_inv, data = canopy_cover_summary)
summary(cc_fire_mod)

```



# Species Data - 1-meter Quadrats

```{r load 1m quadrat data}

quadrat_data <- read_csv("data/processed_data/quadrat1m.csv")
# summary(quadrat_data)
quadrat_data$date <- as.Date(as.character(quadrat_data$date), format = "%Y%m%d")
quadrat_data <- quadrat_data %>% 
      mutate(visit_year = lubridate::year(date))
# filter(quadrat_data, is.na(years_since_fire))

## This is all done in the 'quadrat-data-qaqc.R' script
# quadrat_data$herb_veg_ht1 <- as.numeric(quadrat_data$herb_veg_ht1)
# quadrat_data$herb_veg_ht2 <- as.numeric(quadrat_data$herb_veg_ht2)
# quadrat_data$herb_veg_ht3 <- as.numeric(quadrat_data$herb_veg_ht3)
# quadrat_data$woody_veg_ht1[is.na(quadrat_data$woody_veg_ht1)] <- 0
# quadrat_data$woody_veg_ht1 <- as.numeric(quadrat_data$woody_veg_ht1)
# quadrat_data$herb_veg_ht1[is.na(quadrat_data$herb_veg_ht1)] <- 0
# quadrat_data$herb_veg_ht1 <- as.numeric(quadrat_data$herb_veg_ht1)
# quadrat_data$pct_green[quadrat_data$pct_green=="<1"] <- 0.5
# quadrat_data$pct_green <- as.numeric(quadrat_data$pct_green)

quadrat_data <- left_join(
      select(quadrat_data, -notes),
      select(plot_visit_data, -notes)
)

# Filter to only data collected at 10m quadrats - exclude "extra" data from 2017
quadrat10_data <- filter(
      quadrat_data, quadrat_id %in% c("e10","w10","n10","s10")
)

# summary(quadrat10_data)

```

```{r summarize 1m quadrat data across each plot}

quadrat10_summaries <- quadrat10_data %>%
      group_by(plot_id, visit_year, installation) %>%
      summarise(
            avg_woody_ht1 = mean(woody_veg_ht1),
            avg_woody_ht_all = mean(
                  c(woody_veg_ht1,woody_veg_ht2,woody_veg_ht3), na.rm = T),
            avg_herb_ht1 = mean(herb_veg_ht1),
            avg_herb_ht_all = mean(c(herb_veg_ht1, herb_veg_ht2, herb_veg_ht3), na.rm = T),
            avg_litter_depth1 = mean(litter_ht1),
            avg_litter_depth_all =
                  mean(c(litter_ht1,litter_ht2,litter_ht3), na.rm = T),
            avg_pct_green = mean(pct_green),
            avg_pct_litter = mean(pct_litter),
            avg_pct_wood = mean(pct_wood_litter),
            avg_pct_bare = mean(pct_bare))
# skimr::skim(quadrat10_summaries)

quadrat10_summaries <- left_join(
      quadrat10_summaries,
      plot_visit_data
)

(herb_ht_fig <- ggplot(quadrat10_summaries, 
                      aes(years_since_fire, avg_herb_ht_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Herbaceous plant height (cm)") +
      xlab("Years since fire") +
      # ggtitle("Height of herbaceous species") +
      theme(legend.position = c(.85,.9)) +
      NULL
)

      
(woody_ht_fig <- ggplot(quadrat10_summaries, aes(years_since_fire, avg_woody_ht_all)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Woody plant height (cm)") +
      xlab("Years since fire") +
      # ggtitle("Height of woody species") +
      theme(legend.position = c(.85,.9)) +
      NULL
)

(litter_depth_fig <- ggplot(quadrat10_summaries, aes(years_since_fire, avg_litter_depth_all)) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm") +
      geom_point(aes(color = imcy_inv), size = 2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years since fire") +
      ylab("Litter depth (cm)") +
      theme(legend.position = c(.85,.9)) +
      NULL
)

(pct_litter_fig <- ggplot(quadrat10_summaries, aes(years_since_fire, avg_pct_litter)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      # stat_summary(aes(color = imcy_inv), fun.data = "mean_se", geom = "pointrange") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years since fire") +
      ylab("Litter cover (%)") +
      theme(legend.position = c(.85,.1)) +
      NULL
)


```

```{r pct-bare-fire-fig}

(pct_bare_fig <- ggplot(quadrat10_summaries, aes(years_since_fire, avg_pct_bare)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = F) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      xlab("Years since fire") +
      ylab("Bare ground (%)") +
      theme(legend.position = c(.85,.9)) +
      NULL
)

```


```{r load species data}

species_data <- read_csv("data/processed_data/species1m.csv")
# summary(species_data)
# nrow(filter(species_data, is.na(functional_group)))
# nrow(filter(species_data, is.na(functional_group__1)))
species_data <- species_data %>% 
      select(-functional_group__1, -Order)
species_data <- left_join(
      species_data,
      select(plot_visit_data, -notes)
)

# names(species_data)
# unique(species_data$veg_id)
# sort(unique(species_data$scientific_name))

# str(species_data)
summary(species_data)

# filter(species_data, scientific_name == "NA NA")$functional_group


species_data$functional_group <- tolower(species_data$functional_group)
# is.na(unique(species_data$functional_group))
# filter(species_data, is.na(functional_group))

species10_data <- species_data %>% 
      filter(quadrat_id %in% c("e10","w10","n10","s10"))


```

```{r summarize veg cover}

veg_cover_data <- species10_data %>% arrange(date) %>% 
      group_by(installation, plot_id, visit_year, functional_group) %>% 
      summarise(
            total_pct_cover = sum(pct_cover),
            avg_pct_cover = mean(pct_cover)
      )
veg_cover_data <- left_join(
      veg_cover_data,
      plot_visit_data
)
# summary(veg_cover_data)
# filter(veg_cover_data, is.na(imcy_inv))

(fxgroup_cover_fig <- ggplot(filter(veg_cover_data, !is.na(last_fire_year)), 
       aes(years_since_fire, avg_pct_cover)) +
      geom_point(aes(color = imcy_inv)) +
      stat_summary(fun.data = "mean_se", geom = "pointrange") +
      # geom_smooth() +
      invasion_color +
      facet_grid(installation_full_name~.) +
      theme_bw() +
      def_theme +
      theme(legend.position = "top")
)

```


## Understory vegetation cover
```{r average species cover, fig.height=9}

# datac$se <- datac$sd / sqrt(datac$N)
# species_data$imcy_inv <- factor(species_data$imcy_inv, levels = c("uninvaded","invaded"))

## Create data frame of vegetation cover averaged across plots, burn units, and installations
# avg_species_cover <- species10_data %>%
#              group_by(installation_full_name, visit_year, plot_id, imcy_inv, years_since_fire, quadrat_id) %>%
#       summarise(veg_cover = sum(pct_cover, na.rm = T)) %>% 
#       ungroup(.) %>% 
#       group_by(installation_full_name, imcy_inv, years_since_fire, plot_id) %>%
#              summarise(avg_veg_cover = mean(veg_cover, na.rm = T),
#                        # n_obs = length(veg_id),
#                        max_veg_cover = max(veg_cover, na.rm = T),
#                        se_veg_cover = sd(veg_cover, na.rm = T)/sqrt(length(veg_cover)))
# summary(avg_species_cover)
# avg_species_cover <- filter(avg_species_cover, is.na(years_since_fire))
veg_cover_quadrats <- species10_data %>%
      # filter(quadrat_id %in% c("w10","e10","n10","s10")) %>% 
      group_by(installation_full_name, visit_year, plot_id, imcy_inv, years_since_fire, quadrat_id) %>%
      summarise(quadrat_veg_cover = sum(pct_cover, na.rm = T)) %>% 
      ungroup(.)

ggplot(veg_cover_quadrats, aes(years_since_fire, quadrat_veg_cover)) +
      geom_point(aes(color = imcy_inv), size = 2) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm") +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      theme(legend.position = c(.85,.9)) +
      NULL


veg_cover_plot_data <- species10_data %>%
      group_by(installation_full_name, visit_year, plot_id, imcy_inv, years_since_fire, quadrat_id) %>%
      summarise(veg_cover = sum(pct_cover, na.rm = T)) %>% 
      ungroup(.) %>% 
      group_by(plot_id, visit_year, imcy_inv, years_since_fire, installation_full_name) %>% 
      summarise(
            plot_avg_veg_cover = mean(veg_cover, na.rm = T),
            n_obs = length(veg_cover),
            max_veg_cover = max(veg_cover, na.rm = T),
            sd_veg_cover = sd(veg_cover, na.rm = T),
            se_veg_cover = sd_veg_cover / sqrt(n_obs)) %>% 
      ungroup(.)


(veg_cover_fig <- ggplot(veg_cover_plot_data,
      aes(years_since_fire, plot_avg_veg_cover)) +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      # geom_errorbar(aes(ymin = plot_avg_veg_cover + se_veg_cover, ymax = plot_avg_veg_cover - se_veg_cover), width = 0, position=position_dodge(width = .9)) +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm") +
      geom_point(aes(color = imcy_inv)) +
      invasion_fill +
      invasion_color +
      # facet_grid(installation_full_name~.) +
      theme_classic() +
      ylab("Vegetation cover (%)") +
      xlab("Years since fire") +
      ggtitle("Plot averages for herbaceous vegetation cover") +
      def_theme +
      theme(legend.position = c(.8,.9)) +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/avg-pct-cover-bars.png", height = 9)

```


## Understory species richness
```{r species richness}

species_richness <- species10_data %>%
      group_by(installation_full_name, years_since_fire, imcy_inv, plot_id) %>%
      summarise(richness = n_distinct(scientific_name)) %>% 
      mutate(ln_richness = log(richness),
             max_richness = max(richness))

invaded_quadrats <- species10_data %>% 
      filter(scientific_name=="Imperata cylindrica") %>% 
      mutate(quadrat_invaded = "yes") %>% 
      select(installation:quadrat_id, quadrat_invaded, years_since_fire, installation_full_name)

species10_data <- left_join(species10_data, invaded_quadrats)
species10_data$quadrat_invaded[is.na(species10_data$quadrat_invaded)] <- "no"

quadrat_species_richness <- species10_data %>%
      group_by(installation_full_name, years_since_fire, plot_id, quadrat_invaded, quadrat_id) %>%
      summarise(richness = n_distinct(scientific_name)) %>% 
      mutate(ln_richness = log(richness),
             max_richness = max(richness),
             invasion_status = factor(quadrat_invaded, levels = c("no","yes"), labels = c("Uninvaded","Invaded")))

# quadrat10_richness <- quadrat_species_richness %>% 
#       filter(quadrat_id %in% c("e10","n10","s10","w10"))

```

There were `r length(invaded_quadrats$quadrat_invaded)` (`r round(100*length(invaded_quadrats$quadrat_invaded)/length(quadrat_species_richness$richness), digits = 1)` %) 1-m quadrats located in invaded areas representing `r n_distinct(invaded_quadrats$years_since_fire)` different years since fire at `r n_distinct(invaded_quadrats$installation)` different installations (`r unique(invaded_quadrats$installation_full_name)`).

```{r quadrat richness figure}

## All points
# ggplot(quadrat_species_richness, aes(years_since_fire, richness, color = invasion_status)) +
#       # geom_boxplot(notch = F) +
#       geom_point(position = "jitter") +
#       invasion_color +
#       invasion_fill +
#       geom_smooth(show.legend = F, alpha = .2, aes(fill = invasion_status)) +
#       # facet_grid(.~installation) +
#       theme_classic() +
#       xlab("") +
#       ylab("Richness") +
#       ggtitle("Quadrat-level species diversity")


(quadrat_richness_fig <- ggplot(quadrat_species_richness, aes(years_since_fire, richness, color = invasion_status)) +
      # geom_boxplot(aes(fill = quadrat_invaded), position = "dodge") +
      geom_point(aes(color = invasion_status), alpha = .5, size = 1) +
      # geom_smooth(show.legend = F, alpha = .2, aes(fill = invasion_status)) +
      # stat_summary(fun.y = "mean", geom = "point") +
      stat_summary(fun.data = "mean_se", geom = "pointrange", alpha = .7) +
      facet_grid(installation_full_name~.) +
      invasion_color +
      invasion_fill +
      # theme_classic() +
      theme_bw() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire") +
      ggtitle("1m quadrat understory species diversity") +
      theme(strip.background = element_blank()) +
      NULL
)

```

Species richness at the quadrat level was highly variable, though tended to be highest during the first year following fire.

```{r plot richness fig}

(plot_richness_fig <- ggplot(species_richness, aes(years_since_fire, richness, color = imcy_inv)) +
      # geom_boxplot(aes(fill = quadrat_invaded), position = "dodge") +
      geom_point(aes(color = imcy_inv), size = 1) +
      geom_smooth(show.legend = F, alpha = .2, aes(fill = imcy_inv)) +
      # stat_summary(fun.y = "mean", geom = "point") +
      stat_summary(fun.data = "mean_se", geom = "pointrange", alpha = .7) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire") +
      ggtitle("Plot understory species diversity") +
      theme(legend.position = c(.8,.8))
)

# (plot10_richness_fig <- ggplot(species10_richness, aes(years_since_fire, richness, color = imcy_inv)) +
#       # geom_boxplot(aes(fill = quadrat_invaded), position = "dodge") +
#       geom_point(aes(color = imcy_inv), alpha = .5, size = .5) +
#       geom_smooth(show.legend = F, alpha = .2, aes(fill = imcy_inv)) +
#       # stat_summary(fun.y = "mean", geom = "point") +
#       stat_summary(fun.data = "mean_se", geom = "pointrange", alpha = .7) +
#       invasion_color +
#       invasion_fill +
#       theme_classic() +
#       def_theme +
#       ylab("Richness") +
#       xlab("Years since fire") +
#       ggtitle("Plot understory species diversity") +
#       theme(legend.position = c(.8,.8))
# )

```

```{r fx groups fig}

plot_fxgroups <- species_data %>% 
      filter(functional_group=="graminoid"|functional_group=="forb"|functional_group=="tree"|functional_group=="shrub") %>% 
      filter(quadrat_id %in% c("e10","n10","s10","w10")) %>% 
      group_by(installation, years_since_fire, imcy_inv, plot_id, functional_group) %>% 
      summarise(fxgroup_abundance = n_distinct(scientific_name))

ggplot(plot_fxgroups, 
       aes(years_since_fire, fxgroup_abundance, color = functional_group)) +
      geom_point(position = "jitter", alpha = .5) +
      stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_smooth(alpha = .1, se=F, method = "lm") +
      # invasion_color +
      theme_classic() +
      xlab("Years since fire") +
      ylab("Abundance") +
      # ggtitle("Functional group diversity") +
      NULL

```

There is no clear effect of cogongrass invasion on diversity in these data, however, the representation of invasion is very small within each time since fire grouping. In two cases we have only a single sampling point, so no estimate of variation. We do see a non-linear relationship with the time since last fire, where richness is initially highest a few months following a fire, then decreases for 1-2 years before increasing small amount and then declining again after about 6 years after the last fire.

```{r 5pct species cover, eval=F}

species_over_5pct <- filter(species_data, pct_cover>5)
# species_sub_over_5pct <- filter(species_sub_over_5pct, cogongrass != "NA")
summary(species_over_5pct)
species_over_5pct <- filter(species_over_5pct, !is.na(years_since_fire))

ggplot(species_over_5pct,
       aes(years_since_fire, pct_cover, color = scientific_name)) +
      geom_point() +
      # theme_classic() +
      theme_bw() +
      def_theme +
      scale_fill_viridis_c() +
      facet_grid(installation_full_name~imcy_inv) +
      ylab("% cover") +
      xlab("Years since fire") +
      ggtitle("Range of species cover (>5%) at 1-meter quadrats")
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/species-pct-cover.png", height = 7.5, width = 7.5)

```

# Tree Data

```{r load tree data, results='hide'}

tree_data_import <- read_csv("data/processed_data/trees.csv")
# tree_data
# summary(tree_data_import)

tree_data <- tree_data_import %>% 
      select(installation:date, species:canopy, height, char) %>% 
      mutate(date = as.Date(as.character(date), format = "%Y%m%d"),
             visit_year = lubridate::year(date))
      
# unique(tree_data$plot_id)

tree_data <- left_join(
      tree_data,
      select(plot_visit_data, -notes)) %>% 
      rename(tree_id = species) %>% 
      mutate(labels = "")

# sort(unique(tree_data$tree_id))
tree_data$tree_id <- tolower(tree_data$tree_id)

# tree_data$genus[tree_data$tree_id=="acru"] <- "Acer"
# tree_data$genus[tree_data$tree_id=="bay"] <- "Persea"
# tree_data$genus[tree_data$tree_id=="carya"] <- "Carya"
# tree_data$genus[tree_data$tree_id=="divi5"] <- "Diospyros"
# tree_data$genus[tree_data$tree_id=="hawthorn"] <- "Crataegus"
# tree_data$genus[tree_data$tree_id=="ilvo"] <- "Ilex"
# tree_data$genus[tree_data$tree_id=="list2"] <- "Liquidambar"
# tree_data$genus[tree_data$tree_id=="litu"] <- "Liriodendron"
# tree_data$genus[tree_data$tree_id=="magnolia"] <- "Magnolia"
# tree_data$genus[tree_data$tree_id=="sassafras"] <- "Sassafras"
# tree_data$genus[tree_data$tree_id=="tupelo"] <- "Nyssa"
# tree_data$genus[tree_data$tree_id=="vaccinium"] <- "Vaccinium"

tree_data$labels[agrep("qu", tree_data$tree_id, max.distance = 0)] <- "Quercus"
tree_data$labels[agrep("pi", tree_data$tree_id, max.distance = 0)] <- "Pinus"
# tree_data$genus[is.na(tree_data$tree_id)] <- "Unknown (dead)"
tree_data$labels[!(tree_data$labels %in% c("Quercus","Pinus"))] <- "Other"

# tree_data$imcy_inv <- factor(tree_data$imcy_inv, levels = c("Uninvaded","Invaded"))

# summary(tree_data)
# filter(tree_data, is.na(years_since_fire))$plot_id
# skimr::skim(tree_data)

tree_grp_summary <- tree_data %>% 
      filter(health!=0) %>% 
      group_by(plot_id, labels, years_since_fire, imcy_inv, visit_year) %>% 
      summarise(
            total_dbh_cm = sum(dbh, na.rm = T),
            avg_dbh_cm = mean(dbh, na.rm = T),
            n_stems = length(tree_id))
# summary(tree_grp_summary)
# filter(tree_grp_summary, is.na(avg_dbh_cm))$plot_id

dbh_by_tree_grp <- tree_grp_summary %>% 
      select(-avg_dbh_cm, -n_stems) %>% 
      spread(labels, total_dbh_cm) %>% 
      mutate(Quercus = if_else(is.na(Quercus)==TRUE,0,Quercus),
                   Pinus = if_else(is.na(Pinus)==TRUE,0,Pinus),
                   Other = if_else(is.na(Other)==TRUE,0,Other),
                   total_dbh = rowSums(cbind(Other,Pinus,Quercus), na.rm = T),
                   pct_pinus_dbh = 100*(Pinus/total_dbh))
summary(d)

tree_data_plot_summary <- tree_data %>% 
      filter(health!=0) %>% 
      group_by(plot_id, years_since_fire, imcy_inv, visit_year, installation_full_name) %>% 
      summarise(
            total_dbh = sum(dbh, na.rm = T),
            richness = n_distinct(tree_id),
            avg_tree_ht = mean(height, na.rm = T),
            avg_char_ht = mean(char, na.rm = T))
# summary(tree_data_plot_summary)

tree_data_plot_summary <- left_join(
      tree_data_plot_summary, 
      select(dbh_by_tree_grp, plot_id:visit_year, pct_pinus_dbh)
      )
summary(tree_data_plot_summary)


skimr::skim(ungroup(tree_data_plot_summary))

# filter(tree_data_plot_summary, is.na(avg_char_ht), visit_year==2018)$plot_id
# filter(tree_data, plot_id=="benning j1")$char

```

## Tree richness
```{r tree richness figure}

# tree_richness <- tree_data %>% 
#       group_by(installation_full_name, years_since_fire, imcy_inv, plot_id) %>% 
#       summarise(richness = n_distinct(species)) %>% 
#       filter(!is.na(imcy_inv))

(tree_richness_fig <- ggplot(tree_data_plot_summary, 
       aes(years_since_fire, richness, color = imcy_inv)) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", size = 1) +
      geom_point(position = position_jitter(height = .05), alpha = .8) +
      geom_smooth(aes(fill = imcy_inv), method = "lm") +
      invasion_color +
      invasion_fill +
      # facet_grid(installation_full_name~.) +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire") +
      ggtitle("Tree diversity vs. time since fire") +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-richness-by-fire.png", height=7.5, width = 7.5)

```

## Tree basal area
```{r tree basal area figure}

# plot_basal_area <- tree_data %>%
#       group_by(installation_full_name, labels, years_since_fire, plot_id) %>%
#       mutate(basal_area_ha = (pi*((.5*dbh/100)^2))/.05) %>% 
#       summarise(total_basal_area_ha = sum(basal_area_ha))
# 
# basal_area_data <- tree_data %>%
#       group_by(installation_full_name, labels, years_since_fire) %>%
#       mutate(basal_area_ha = (pi*((.5*dbh/100)^2))/.05) %>% 
#       summarise(total_basal_area_ha = sum(basal_area_ha),
#                 avg_basal_area_ha = mean(basal_area_ha),
#                 se_basal_area_ha = sd(basal_area_ha)/sqrt(length(basal_area_ha)))

(tree_dbh_fig <- ggplot(tree_data_plot_summary, 
       aes(years_since_fire, total_dbh, color = imcy_inv)
       ) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", position = "jitter") +
      geom_point() +
      geom_smooth(aes(fill = imcy_inv), method = "lm", se = T) +
      # geom_violin(aes(labels, dbh, fill = labels)) +
      # geom_dotplot(aes(labels, dbh, fill = labels),
      #            binaxis = "y",         # which axis to bin along
      #            binwidth = 0.4,       # Minimal difference considered different
      #            stackdir = "center"    # Centered
      #            ) +
      # geom_bar(aes(fill = labels), stat = "identity", position = "dodge") +
      # geom_errorbar(aes(ymin = avg_basal_area_ha + se_basal_area_ha, ymax = avg_basal_area_ha - se_basal_area_ha), width = .2, position = position_dodge(width = .5)) +
      # scale_color_brewer(palette = "Dark2") +
      invasion_color +
      invasion_fill +
      # facet_grid(installation_full_name~.) +
      theme_classic() +
      # theme_bw() +
      xlab("Years since fire") +
      # ylab(expression(paste("Basal Area (", m^{2}, " ", ha^{-1}, ")"))) +
      ylab("DBH (cm)") +
      ggtitle("Total tree DBH across plots") +
      def_theme +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/total-dbh-by-fire.png", height=7)

```

```{r proportion pine dbh figure}

(pct_pine_fig <- ggplot(filter(tree_data_plot_summary, pct_pinus_dbh>=0), 
       aes(years_since_fire, pct_pinus_dbh)
       ) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange", position = "jitter") +
      geom_smooth(method = "lm", se = F) +
      geom_point(aes(color = imcy_inv)) +
      geom_smooth(data=filter(tree_data_plot_summary, pct_pinus_dbh<60),
                  aes(years_since_fire, pct_pinus_dbh),
                  method = "lm", se = F, linetype="dashed") +
       geom_smooth(data=filter(tree_data_plot_summary, pct_pinus_dbh>60),
                  aes(years_since_fire, pct_pinus_dbh),
                  method = "lm", se = F, linetype="dotted") +
      invasion_color +
      invasion_fill +
      # facet_grid(installation_full_name~.) +
      theme_classic() +
      # theme_bw() +
      xlab("Years since fire") +
      # ylab(expression(paste("Basal Area (", m^{2}, " ", ha^{-1}, ")"))) +
      ylab("Percent pine DBH ") +
      # ggtitle("Total tree DBH across plots") +
      def_theme +
      NULL
)

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/pct-pine-dbh.png", height=7.5, width = 7.5)

```

The dashed line is just for the data where pine makes up *less than* 60% of the total DBH; the dotted line is for the data where pine makes up *more than* 60% of the total DBH.

## Tree dbh
```{r tree dbh, eval = F}

ggplot(tree_data %>%
             filter(!is.na(imcy_inv)) %>% 
             group_by(installation_full_name, labels, years_since_fire, imcy_inv),
       aes(as.factor(years_since_fire), dbh, color = labels)) +
      geom_point(position = "jitter") +
      scale_fill_brewer(palette = "Dark2") +
      scale_color_brewer(palette = "Dark2") +
      facet_grid(installation_full_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Diameter at breast height") +
      def_theme +
      theme(strip.background = element_blank(),
            panel.grid = element_blank())
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-dbh-jitter.png", height=7)
```

## Tree height
```{r tree height, eval = F}
# tree_height <- tree_data %>%
#       group_by(installation_full_name, labels, years_since_fire, imcy_inv) 

ggplot(tree_data %>% 
             filter(!is.na(imcy_inv)),
       aes(years_since_fire, height, color = labels)) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_point(position = "jitter") +
      scale_color_brewer(palette = "Dark2") +
      facet_grid(installation_full_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Tree height") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-height-jitter.png", height=7)

```

```{r char height figure}
# tree_data_plot_summary
ggplot(tree_data_plot_summary,
       aes(imcy_inv, avg_char_ht, fill = imcy_inv, color = imcy_inv)) +
      stat_summary(fun.data = "mean_se", geom = "pointrange") +
      # geom_point(position = "jitter") +
      # geom_bar(stat = "identity", position = "dodge") +
      invasion_color +
      invasion_fill +
      # facet_grid(installation_full_name~.) +
      # theme_bw() +
      theme_classic() +
      xlab("") +
      ylab("Char height (m)") +
      def_theme +
      theme(legend.position = "top")

ggsave("~/Dropbox (UF)/SERDP-Project/figures/char-height.png", height=7.5, width = 7.5)

```


# Sub-plot sapling/shrub data

```{r 100m subplot, results='hide'}

subplot_data <- read_csv("data/raw_data/subplot-woody-species.csv")
subplot_data$date <- as.Date(as.character(subplot_data$date), format="%Y%m%d")
subplot_data$plot_id <- tolower(subplot_data$plot_id)
subplot_data$installation[subplot_data$installation=="avon"] <- "avonpark"

subplot_data <- subplot_data %>% 
      select(-under_50cm,-`50-99cm`) %>% 
      filter(date >"2017-06-01") %>% 
      mutate(stems_100m2 = round(if_else(date<"2018-01-01", over_100cm*.599,over_100cm*1)),
             visit_year = lubridate::year(date),
             plot_id = paste(installation, plot_id, sep = " "))

subplot_data <- left_join(
      subplot_data,
      select(plot_visit_data, -notes)
)

# summary(subplot_data)
# filter(subplot_data, is.na(years_since_fire))

subplot_plot_summary <- subplot_data %>% 
      group_by(plot_id, visit_year, imcy_inv, years_since_fire, installation_full_name) %>% 
      summarise(shrub_sap_rich = n_distinct(veg_id),
                total_stems_100m2 = sum(stems_100m2))
summary(subplot_plot_summary)

```

```{r subplot figure}

(shrub_saplings_fig <- ggplot(
      subplot_plot_summary,
      aes(years_since_fire, log1p(total_stems_100m2), color = imcy_inv)) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_point(aes(color = imcy_inv), alpha = .5) +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "lm") +
      invasion_color +
      invasion_fill +
      # facet_grid(.~veg_id) +
      theme_classic() +
      def_theme +
      # theme(legend.position = c(.85,.85)) +
      xlab("Years since fire") +
      ylab(expression(paste("Stem density (100 ", {m}^-2,")"))) +
      ggtitle("")
)

ggsave("~/Dropbox (UF)/SERDP-Project/figures/subplot_density.png", height=7.5, width = 7.5)

```


# Biomass data sampled at 25cm quadrats

Biomass is averaged across the four 25 cm quadrats for each plot, and then these values are summarized in the figures across the roughly estimated years since fire. 

```{r 25cm biomass data, results='hide'}

biomass_data <- read_csv("data/raw_data/quadrat25cm.csv")
biomass_data$date <- as.Date(as.character(biomass_data$date), format="%Y%m%d")
biomass_data <- filter(biomass_data, date>"2017-04-25", plot_id!="bland02", plot_id!="bland03")
# summary(biomass_data)

biomass_data <- biomass_data %>% 
      mutate(pct_litter_moisture = 100*(litter_mass_wet-litter_mass_dry)/litter_mass_wet,
             plot_id = paste(installation, plot_id, sep = " "),
             visit_year = lubridate::year(date))

biomass_data <- left_join(
      biomass_data,
      select(plot_visit_data, -notes))
summary(biomass_data)

filter(biomass_data, is.na(imcy_inv))

# biomass_data$last_fire_year <- as.integer(biomass_data$last_fire_year)
# biomass_data$years_since_fire <- 2017 - biomass_data$last_fire_year

biomass_plot_summary <- biomass_data %>% 
      group_by(plot_id, visit_year, years_since_fire, imcy_inv, installation_full_name) %>% 
      mutate(standing_gm2 = standing_fuel_mass_wet*16,
             litter_gm2 = litter_mass_wet*16,
             dry_standing_gm2 = standing_fuel_mass_dry*16,
             dry_litter_gm2 = litter_mass_dry*16) %>% 
      summarise(avg_dry_standing_gm2 = mean(dry_standing_gm2),
                se_dry_standing_gm2 = sd(dry_standing_gm2)/sqrt(length(dry_standing_gm2)),
                avg_dry_litter_gm2 = mean(dry_litter_gm2),
                se_litter = sd(dry_litter_gm2)/sqrt(length(dry_litter_gm2)),
                avg_pct_litter_moisture = mean(pct_litter_moisture))
summary(biomass_plot_summary)

biomass_plot_summary <- filter(biomass_plot_summary, !is.na(years_since_fire))
# filter(biomass_plot_summary, is.na(se_litter))
```

```{r standing biomass fig}

(stand_biomass_fig <- ggplot(biomass_plot_summary,
       aes(years_since_fire, avg_dry_standing_gm2, color = imcy_inv)) +
      # geom_point() +
      stat_summary(fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      # facet_grid(.~installation) +
      # geom_smooth(aes(fill = imcy_inv), se = T, alpha = .1) +
      theme_classic() +
      ylab(expression(paste("Standing biomass (g ", m^{-2}, ")"))) +
      xlab("Years since last fire") +
      ggtitle("Dry standing biomass",
              subtitle = "(measurements at 25cm quadrats)") +
      theme(legend.title = element_blank()) +
      def_theme
)

ggsave("~/Dropbox (UF)/SERDP-Project/figures/standing-biomass.png", height=7.5, width = 7.5)

```

```{r litter biomass fig}

(litter_mass_fig <- ggplot(biomass_plot_summary,
        aes(years_since_fire, avg_dry_litter_gm2, color = imcy_inv)) +
      geom_point(alpha = .5) +
      geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "loess", linetype = "dashed", se = F) +
       geom_smooth(aes(fill = imcy_inv), alpha = .2, method = "lm") +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(fill = imcy_inv), se = T, alpha = .1) +
      # facet_grid(.~installation) +
      theme_classic() +
      ylab(expression(paste("Litter biomass (g ", m^{-2}, ")"))) +
      xlab("Years since last fire") +
      # ggtitle("Dry litter biomass",
              # subtitle = "(measurements at 25cm quadrats)") +
      def_theme
       # theme(legend.position = c(.85,.85))
)

ggsave("~/Dropbox (UF)/SERDP-Project/figures/litter-biomass.png", height = 7.5, width = 7.5)

```


# Host Abundance Estimates

```{r dung data, results='hide'}

dung_data <- read_csv("data/raw_data/dung.csv")
dung_data$plot_id <- tolower(dung_data$plot_id)
dung_data$species <- tolower(dung_data$species)
dung_data$location <- tolower(dung_data$location)
dung_data$date <- as.Date(as.character(dung_data$date), format="%Y%m%d")
summary(dung_data)
filter(dung_data, is.na(species), dung1m>0 | dung2m>0)

dung_data <- dung_data %>% 
      mutate(visit_year = lubridate::year(date),
             plot_id = paste(installation, plot_id, sep = " "))
# sort(unique(dung_data$plot_id))
filter(dung_data, is.na(dung1m))

dung_data <- left_join(select(plot_visit_data, -notes),
                       dung_data)
summary(dung_data)
filter(dung_data, is.na(dung1m))

# dung_data <- rename(dung_data, clusters1m = `1m`, clusters2m = `2m`)
dung_plot_avg_data <- dung_data %>% 
      group_by(installation, plot_id, visit_year, years_since_fire, imcy_inv) %>% 
      summarise(avg_clusters1m = mean(dung1m, na.rm = T),
                avg_clusters1m_2m = mean(rowSums(cbind(dung1m,dung2m)))
                )
summary(dung_plot_avg_data)
# skimr::skim(dung_data_avg)

```

```{r dung species figure}

(dung_species_fig <- ggplot(filter(dung_data, dung1m>0), aes(years_since_fire, log1p(dung1m))) +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      geom_point(aes(color = species), size = 2, position = "jitter") +
      # geom_smooth(aes(color = species)) +
      invasion_fill +
      # invasion_color +
      # geom_smooth(aes(linetype = imcy_inv), se = F, alpha = .1) +
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .1, method = "lm") +
      theme_classic() +
      ylab("log( # of dung clusters )") +
      xlab("Years since fire") +
      # ylab("Dung clusters") +
      def_theme +
      theme(legend.position = c(.85,.85))
)

ggsave("~/Dropbox (UF)/SERDP-Project/figures/dung-species.png", height=7.5, width = 7.5)

```

```{r dung plot avg figure}

dung_plot_avg_data_noNA <- filter(dung_plot_avg_data, !is.na(avg_clusters1m))

(dung_plot_avg_fig <- ggplot(
      dung_plot_avg_data_noNA, 
      aes(years_since_fire, log1p(avg_clusters1m), color = imcy_inv)) +
      geom_point(size = 1, position = "jitter", alpha = .3) +
      stat_summary(fun.data = "mean_se", geom = "pointrange") +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      # geom_smooth(aes(color = species)) +
      invasion_fill +
      invasion_color +
      # geom_smooth(aes(linetype = imcy_inv), se = F, alpha = .1) +
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .1, method = "lm") +
      theme_classic() +
      ylab("log( # of dung clusters )") +
      xlab("Years since fire") +
      # ylab("Dung clusters") +
      def_theme +
      theme(legend.position = c(.8,.9))      
)

ggsave("~/Dropbox (UF)/SERDP-Project/figures/dung-vs-fire.png", height=7.5, width = 7.5)
      
```

# Tick Abundance

## Tick species

- Lone star ticks, *Amblyomma americanum* abbreviation: Am. am

![](pictures/lone-star-ticks.png)

- Gulf coast ticks *Amblyomma maculatum* abbreviation: Am. mac.

![](pictures/gulf-coast-ticks.png)

- American dog ticks *Dermecentor variablis* abbreviation: De. var

![](pictures/american-dog-ticks.png)

- Brown dog ticks *Rhipicephalus sanguineus* abbreviation: Rh. san

![](pictures/brown-dog-ticks.png)

- Black-legged or deer ticks *Ixodes scapularis* abbreviation: Ix. sc

![](pictures/deer-ticks.png)

```{r tick data QC, results='hide'}

tick_data <- read_csv("data/processed_data/ticks.csv")
tick_data
summary(tick_data)
skimr::skim(tick_data)

sort(unique(tick_data$plot_id))
sort(unique(tick_data$installation))
sort(unique(tick_data$species))

# plot_visit_data
names(plot_visit_data)
names(tick_data)
tick_data <- tick_data %>% 
      mutate(date = as.Date(as.character(tick_data$date), format = "%Y%m%d"),
             visit_year = lubridate::year(date),
             life_stage = factor(life_stage, levels = c("A","N","L"),))

tick_data <- left_join(
      select(tick_data, -notes),
      select(plot_visit_data, -notes)
)
summary(tick_data)

tick_data$life_stage <- factor(
      tick_data$life_stage, 
      levels = c("A","N","L"),
      labels = c("Adult","Nymph","Larval"))
# summary(tick_data)
filter(tick_data, is.na(years_since_fire))
filter(tick_data, is.na(imcy_inv))
# "extra" ticks at Moody AFB were from an area last burned in 2005
# tick_data$years_since_fire[tick_data$installation=="moody"] <- 2017-2005
# tick_data <- tick_data[is.na(tick_data$years_since_fire)==FALSE,]
# tick_data$installation_full_name[tick_data$installation=="moody"] <- "Moody AFB"

# tick_data$date <- as.Date(as.character(tick_data$date), format = "%Y%m%d")

## Count larvae bombs as "1"
tick_data <- tick_data %>% 
      mutate(tick_count = ifelse(life_stage=="Larval",1,count),
             tick_count = ifelse(is.na(tick_count),0,tick_count))
summary(tick_data)
# filter(tick_data, is.na(tick_count))$count

```

## Total ticks collected across burn units 

The high tick abundance for 8-years post-fire is driven by a single plot at Camp Blanding.

```{r tick life stage abundance fire}
tick_data %>% 
      filter(!is.na(imcy_inv), !is.na(life_stage)) %>% 
ggplot(aes(years_since_fire, log1p(tick_count), color = imcy_inv, fill = imcy_inv)) +
      # geom_bar(stat = "identity", position = "dodge", show.legend = F) +
      geom_violin(aes(fill = imcy_inv), alpha = .3) +
      geom_point(alpha = .3, position = "jitter", size = .5) +
      stat_summary(fun.data = "mean_se", geom = "pointrange") +
      invasion_color +
      invasion_fill +
      scale_x_continuous(breaks = c(seq(0,11,1))) +
      # geom_dotplot(aes(fill = imcy_inv),
      #            binaxis = "y",         # which axis to bin along
      #            binwidth = .2,       # Minimal difference considered different
      #            stackdir = "center"    # Centered
      #            ) +
      facet_grid(life_stage~.) +
      xlab("Years since fire") +
      ylab("log( tick abundance )") +
      # theme_classic() +
      theme_bw() +
      def_theme
      # theme(legend.position = c(.88,.88))

# ggplot(tick_data, aes(as.factor(years_since_fire), count)) +
#       stat_summary(fun.data = "mean_se",geom = "pointrange") +
#       xlab("Years since fire") +
#       ylab("Tick abundance") +
#       theme_classic() +
#       def_theme

ggsave("~/Dropbox (UF)/SERDP-Project/figures/tick-life-stage-vs-fire.png", height=7.5, width = 7.5)

```

## Tick species

**Note the different scales of the y-axes**

```{r tick species vs fire fig, fig.height=9}

ggplot(tick_data %>% 
             filter(!is.na(years_since_fire)) %>% 
             group_by(installation_full_name, years_since_fire, species,) %>%
             summarise(tick_number = sum(count)),
       aes(installation_full_name, tick_number, fill = installation_full_name)) +
      # geom_point(position = "jitter") +
      geom_bar(stat = "identity", position = "dodge") +
      scale_fill_brewer(palette = "Set1") +
      # facet_grid(.~installation_full_name, scales = "free_y") +
      xlab("") +
      ylab("Tick abundance") +
      # theme_bw() +
      theme_classic() +
      def_theme +
      theme(legend.position = c(.85,.85))

ggsave("~/Dropbox (UF)/SERDP-Project/figures/tick-species-installation.png", height=7.5, width = 7.5)

```


## Summarize tick abundance data
```{r summarize-tick-abundance-data}
tick_data_life_stage_summary <- tick_data %>% 
      group_by(plot_id, visit_year, life_stage, years_since_fire, imcy_inv, installation_full_name, date) %>% 
      summarise(total_ticks = sum(count)) %>% 
      ungroup(.)


tick_data_plot_summary <- tick_data %>% 
      group_by(installation, plot_id, visit_year, years_since_fire, imcy_inv, installation_full_name) %>% 
      summarise(total_ticks = sum(count)) %>% 
      ungroup(.)

summary(tick_data_plot_summary)
filter(tick_data_plot_summary, is.na(years_since_fire))


# plot_data
# tick_data_sum <- left_join(plot_visit_data, tick_data_sum)
# tick_data_sum$total_ticks[is.na(tick_data_sum$total_ticks)] <- 0

tick_biomass_data <- left_join(
      tick_data_plot_summary, 
      ungroup(biomass_plot_summary))

tick_quad10_data <- left_join(
      tick_data_plot_summary,
      select(ungroup(quadrat10_summaries), -date))

tick_vegcover_data <- left_join(
      tick_data_plot_summary,
      ungroup(veg_cover_plot_data)
)

tick_canopycover_data <- left_join(
      tick_data_plot_summary, 
      select(ungroup(canopy_cover_summary), -date))

tick_host_data <- left_join(
      tick_data_plot_summary, 
      ungroup(dung_plot_avg_data))

tick_tree_data <- left_join(
      tick_data_plot_summary, 
      ungroup(tree_data_plot_summary))

tick_subplot_data <- left_join(
      tick_data_plot_summary,
      ungroup(subplot_plot_summary)
)

tick_data_sum <- join_all(list(tick_biomass_data, tick_canopycover_data, tick_quad10_data, tick_host_data, tick_host_data, tick_tree_data, tick_subplot_data, tick_vegcover_data)) %>% 
      select(-notes)

summary(tick_data_sum)

# unique(tick_data_sum$installation_full_name)
# unique(tree_data_summary$installation_full_name)


# tick_data_sum$imcy_inv <- factor(tick_data_sum$imcy_inv, levels = c("Uninvaded","Invaded"), labels = c("Uninvaded","Invaded"))

# skimr::skim(tick_data_sum)
```


## Tick~fire log-linear relationship 

```{r tick-fire}

unique(tick_data_plot_summary$installation_full_name)
filter(tick_data_plot_summary, is.na(installation_full_name))$plot_id

ggplot(filter(tick_data_plot_summary, !is.na(imcy_inv)), 
       aes(years_since_fire, log1p(total_ticks), color = imcy_inv)) +
      # geom_smooth(aes(fill = imcy_inv), se = F, method = "loess", linetype = "dashed") +
      geom_smooth(aes(fill = imcy_inv), se = T, method = "lm", alpha = .2) +
      geom_point(aes(shape = installation_full_name), position = "jitter", alpha = .5) +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(color = imcy_inv), method = "loess",
                  # linetype = "dashed", se = F) +
      scale_shape_manual(values = c(inst_name=2, 19, 19, 19, 19, 19, 19, 19, 19)) +
      theme_classic() +
      xlab("Years since fire") +
      ylab("log( tick abundance + 1 )") +
      def_theme

ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-vs-fire.png", height = 7.5, width = 7.5)

```


## Seasonal sampling

```{r tick-abundance-by-date}

tick_data$week <- lubridate::week((tick_data$date))

              # group_by(date, installation_full_name) %>% 
             # summarise(abundance = sum(count))
       
ggplot(filter(tick_data, !is.na(life_stage)),
       aes(date, count)) +
      geom_path(aes(linetype = life_stage)) +
      geom_point(aes(color = installation, shape = life_stage), size = 2) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      # geom_bar(aes(fill = installation_full_name), stat = "identity") +
      # scale_fill_brewer(type = "div") +
      scale_x_date(limits = c(as.Date("2017-06-06"),as.Date("2018-08-01")),
                   date_breaks = "3 month") +
      # geom_smooth() +
      theme_classic() +
      ylab("Tick abundance") +
      xlab("") +
      def_theme +
      theme(legend.position = ,
            legend.background = element_rect(color="black"))

ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-week.png", height=7.5, width = 7.5)
      
```



## Tick abundance vs. latitude

No relationship, which is expected, though our range of latitude is very small. I plan to use an actual climate variable in the model, e.g. PRISM 30-year normals, WorldClim, DayMet, or possibly data from local weather stations.

```{r tick-abundance-latitude, eval=F}

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(ycoord_lat, log1p(total_ticks))) +
      geom_point(aes(color = installation_full_name), position = "jitter") +
      # invasion_color +
      invasion_fill + 
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "lm") +
      geom_smooth(aes(), method = "loess", linetype = "dashed", se = F) +
      facet_grid(imcy_inv~.) +
      scale_color_brewer(palette = "Set2") +
      # theme_classic() +
      theme_bw() +
      xlab("Latitude") +
      ylab("log( tick abundance + 1 )") +
      def_theme

ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-latitude.png", height=7.5, width = 7.5)

```


# Tick abundance vs. plot-level averages

## Understory vegetation cover
```{r tick-veg-cover}

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_veg_cover, log1p(total_ticks), color = imcy_inv)) +
      geom_point(alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), 
                  se = T, alpha = .2, method = "lm", show.legend = F) +
      geom_smooth(aes(fill = imcy_inv), method = "loess", linetype = "dashed",
                  se = F, alpha = .3, show.legend = F) +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab("Average vegetation cover (%)") +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      theme(legend.position = c(.85,.85))

ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-veg-cover.png", height=7.5, width = 7.5)

```


## Understory biomass 
Log-linear relationship, very noisy trends with many zeroes. Plots associated with invasions had either zero or one ticks.

```{r tick-veg-biomass}

(tick_veg_mass_fig <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_dry_standing_gm2, log1p(total_ticks), color = imcy_inv)) +
      geom_point(alpha = .3) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = F) +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      theme_classic() +
      xlab(expression(paste("Average standing biomass (g ", m^{-2}, ")"))) +
      ylab("log( tick abundance + 1 )") +
      ggtitle("Understory standing biomass") +
      def_theme +
      theme(legend.position = c(.85,.85))
)

ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-standing-biomass.png", height=7.5, width = 7.5)
# summary(glm(total_ticks ~ avg_standing_gm2, data = tick_data_sum, family = "quasipoisson"))

```


## Litter percent cover
```{r tick-litter-cover}

(tick_pctlitter_fig <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_pct_litter, log1p(total_ticks), color = imcy_inv)) +
      geom_point(alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = T) +
       geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess", show.legend = T, linetype = "dashed") +
      theme_classic() +
      xlab(expression(paste("Litter cover (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      theme(legend.position = c(.2,.85))
)
ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-cover1.png", height=7.5, width = 7.5)

(tick_pctlitter_fig2 <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_pct_litter, log1p(total_ticks))) +
      geom_point(aes(),alpha = .8) +
      # invasion_color +
      # invasion_fill +
      geom_smooth(se = T, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      theme_classic() +
      xlab(expression(paste("Litter cover (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme
)
ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-cover2.png", height=7.5, width = 7.5)

```


## Litter biomass

Tick abundance plotted against dried litter biomass in invaded and uninvaded plots. 

```{r tick-litter-mass}

(tick_litter_mass_fig <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_dry_litter_gm2, log1p(total_ticks), color = imcy_inv)) +
      geom_point(aes(), alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = F) +
      geom_smooth(aes(), se = F, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab(expression(paste("Litter biomass (g ", m^{-2}, ")"))) +
      ylab("log( tick abundance + 1 )") +
      # ggtitle("Litter biomass") +
      def_theme
      # theme(legend.position = c(.15,.9))
)
ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-mass.png", height=7.5, width=7.5)

```

```{r tick-litter-moisture}

(tick_litter_mass_fig <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_pct_litter_moisture, log1p(total_ticks), color = imcy_inv)) +
      geom_point(aes(), alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm", show.legend = F) +
      geom_smooth(aes(), se = F, alpha = .2, method = "loess", show.legend = F, linetype = "dashed") +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab(expression(paste("Litter moisture (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      theme(legend.position = c(.15,.9)) +
      ggtitle("Litter moisture")
)
ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-litter-mass.png", height = 7.5, width = 7.5)

```



## Canopy cover
Log-linear relationship, where there are more ticks in plots with more canopy cover.
```{r tick-canopy-cover}

(tick_canopy_cover_fig <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_canopy_cover, log1p(total_ticks), color = imcy_inv)) +
      geom_point(aes(), alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm") +
      geom_smooth(aes(), se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
      # facet_grid(imcy_inv~.) +
      theme_classic() +
      # theme_bw() +
      xlab(expression(paste("Canopy cover (%)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme +
      theme(legend.position = c(.15,.9))
)
ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-canopy-cover.png", height=7.5, width = 7.5)

```

## Ticks ~ char height

```{r tick char ht figure}

(tick_char_fig <- ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(avg_char_ht, log1p(total_ticks), color = imcy_inv)) +
      geom_point(aes(), alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm") +
      geom_smooth(se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
       # facet_grid(imcy_inv~.) +
      # geom_smooth(method = "lm", color = "gray50", se = F) +
      theme_classic() +
      # xlab(expression(paste("log( # of dung clusters + 1)"))) +
      # ylab("log( tick abundance + 1 )") +
      def_theme +
      theme(legend.position = c(.85,.9))
)
ggsave("~/Dropbox (UF)/SERDP-Project/figures/tick-char.png", height = 7.5, width = 7.5)

```


## Ticks ~ hosts
Log-log relationship between tick density and host density

```{r tick-hosts}

(tick_host_fig1 <- ggplot(
      filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(log1p(avg_clusters1m), log1p(total_ticks), color = imcy_inv)) +
      geom_point(alpha = .3) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .2, method = "lm") +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
      # geom_smooth(method = "lm", color = "black", se = F) +
      theme_classic() +
      xlab(expression(paste("log( # of dung clusters + 1)"))) +
      ylab("log( tick abundance + 1 )") +
      def_theme
      # theme(legend.position = c(.85,.9))
)
ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-host1.png", height=7.5, width = 7.5)

# (tick_host_fig2 <- ggplot(
#       filter(tick_data_sum, !is.na(imcy_inv), !is.na(life_stage)), 
#        aes(log1p(avg_clusters1m), log1p(total_ticks))) +
#       geom_point(aes(color = imcy_inv), alpha = .5) +
#       # invasion_color +
#       invasion_fill +
#       geom_smooth(aes(), se = T, alpha = .2, method = "lm") +
#       geom_smooth(aes(), se = F, alpha = .2, method = "loess", linetype = "dashed", show.legend = F) +
#       facet_grid(imcy_inv~.) +
#       # geom_smooth(method = "lm", color = "gray50", se = F) +
#       # theme_classic() +
#       theme_bw() +
#       xlab(expression(paste("log( # of dung clusters + 1)"))) +
#       ylab("log( tick abundance + 1 )") +
#       def_theme
# )
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/ticks-by-host1.png", height=7)

```

Loess lines are dashed, lines from the linear model are solid, and the black solid line is the overall trend when pooling the data across invaded and uninvaded plots.

# Host abundance
Host abundance tended to be slightly lower with increasing canopy cover and time since fire. The trend isn't significant
```{r hosts-canopy-cover}

 ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
        aes(avg_canopy_cover, log1p(avg_clusters1m))) +
      geom_point(aes(color = imcy_inv), alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = F, alpha = .2, linetype = "dashed") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", se = T, alpha = .2) +
      theme_classic() +
      xlab(expression(paste("Canopy cover (%)"))) +
      ylab("log( dung clusters + 1 )") +
      def_theme
ggsave("~/Dropbox (UF)/SERDP-Project/figures/hosts-canopy-cover.png", height=7.5, width = 7.5)

```

```{r host-fire}

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
        aes(years_since_fire, log1p(avg_clusters1m))) +
      geom_point(aes(color = imcy_inv), alpha = .5) +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "loess", se = F, alpha = .2, linetype = "dashed") +
      geom_smooth(aes(color = imcy_inv, fill = imcy_inv), method = "lm", se = T, alpha = .2) +
      theme_classic() +
      xlab(expression(paste("Years since fire"))) +
      ylab("log( dung clusters + 1 )") +
      def_theme
ggsave("~/Dropbox (UF)/SERDP-Project/figures/hosts-fire.png", height = 7.5, width = 7.5)

```


```{r host-trees, eval=F}

ggplot(filter(tick_data_sum, !is.na(imcy_inv)), 
       aes(total_dbh, log1p(avg_clusters1m))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F, alpha = .2) +
      theme_classic() +
      xlab(expression(paste("Total DBH (cm)"))) +
      ylab("log( # of dung clusters + 1 ) ") +
      def_theme
ggsave("~/Dropbox (UF)/SERDP-Project/figures/hosts-tree-dbh.png", height=7.5, width = 7.5)

```



# Initial/exploratory linear (OLS) models
```{r linear models ticks}

summary(lm(log1p(total_ticks) ~ years_since_fire, data = tick_data_sum))
summary(lm(log1p(total_ticks) ~ avg_dry_litter_gm2, data = tick_data_sum))
summary(lm(avg_dry_litter_gm2 ~ years_since_fire, data = tick_data_sum))
summary(lm(log1p(total_ticks) ~ avg_canopy_cover, data = tick_data_sum))
summary(lm(avg_canopy_cover ~ years_since_fire, data = tick_data_sum))
# summary(lm(log1p(total_ticks) ~ log1p(avg_clusters1m), data = tick_data_sum))

```

```{r ggpairs plot, eval=F}
# install.packages("GGally")
library(GGally)
ggpairs(select(tick_data_sum, years_since_fire, ycoord_lat, total_ticks, avg_dry_litter_gm2, avg_canopy_cover, avg_clusters1m, pct_pinus_dbh, total_stems_100m2, imcy_inv), aes(color = imcy_inv)) +
      # invasion_color +
      # invasion_fill +
      theme(panel.grid = element_blank())

pairs(select(tick_data_sum, years_since_fire, ycoord_lat, total_ticks:avg_basal_area))
```


```{r path model structure, eval=F}
library(piecewiseSEM)
library(lme4)
#glmmadmb

## Should make an explicit random-effect for the plot for clarity, by combining installation with plot_id

model_list <- list(
      tick_mod <- glmer.nb(total_ticks ~ avg_clusters1m + avg_dry_litter_gm2 + avg_canopy_cover + (1|plot_id), data = tick_data_sum),
      host_mod <- glmer.nb(avg_clusters1m ~ years_since_fire + avg_canopy_cover + (1|plot_id), data = tick_data_sum),
      litter_mod <- lmer(avg_dry_litter_gm2 ~ years_since_fire + (1|plot_id), data = tick_data_sum),
      # div_mod <- lm(log1p(richness) ~ years_since_fire, data = tick_data_sum),
      # bare_grnd_mod <- lmer(avg_pct_bare ~ years_since_fire + (1|years_since_fire) + (1|installation), data = tick_data_sum),
      
      # basal_area_mod <- lmer(avg_basal_area ~ years_since_fire + (1|years_since_fire) + (1|installation), data = tick_data_sum),
      # canopy_mod <- lmer(avg_canopy_cover ~ years_since_fire + + (1|installation) + (1|plot_id), data = tick_data_sum),
      fire_mod <- lmer(years_since_fire ~ ycoord_lat + (1|installation), tick_data_sum)
)

sem.fit(model_list, data = tick_data_sum, conditional = F)
sem.coefs(model_list, data = tick_data_sum, standardize = 'none')
sem.model.fits(model_list, aicc = T)
```


# Cogongrass Data Sampled from Invasions

```{r cogongrass data, eval=F}

cogon_data <- read_csv("data/raw_data/cogon-data.csv")
cogon_biomass <- cogon_data %>%
      # select(site,plot_id,Quad,fresh_biomass) %>%
      filter(site!="NA") %>%
      mutate(fresh_biomass_gm2 = fresh_biomass*16,
             dry_biomass_gm2 = dry_biomass*16)

d1 <- cogon_data %>% 
      mutate(avg_height = rowMeans(cbind(height1,height2,height3)),
             avg_width = rowMeans(cbind(width_1,width_2,width_3))) %>% 
      select(site:CogonSampleID,tiller_density,avg_height,avg_width) %>%
      mutate(est_leaf_area_cm = avg_height*avg_width*tiller_density,
             est_LAI = est_leaf_area_cm/10000)


cogon_ht <- cogon_data %>% 
      select(site:height3) %>% 
      mutate(id = as.integer(seq(1,23,1))) %>% 
      gather(key = fid, value = height_cm, -site, -plot_id, -Quadrant, -CogonSampleID, -id) %>% 
      select(-fid,-id)

cogon_width <- cogon_data %>% 
      select(site:CogonSampleID,width_1:width_3) %>% 
      mutate(id = as.integer(seq(1,23,1))) %>% 
      gather(key = fid, value = width_cm, -site, -plot_id, -Quadrant, -CogonSampleID, -id) %>% 
      select(width_cm)

cogon_ht_width <- bind_cols(cogon_ht, cogon_width) %>% 
      mutate(est_leaf_area_cm = height_cm*width_cm)
summary(cogon_ht_width)

cogon_leaf_area <- left_join(
      select(cogon_data, site:CogonSampleID,tiller_density),
      cogon_ht_width %>%
      group_by(site,plot_id,Quadrant,CogonSampleID) %>% 
      summarise(avg_est_leaf_area_cm = mean(est_leaf_area_cm))
) %>% 
      mutate(total_est_leaf_area = tiller_density*avg_est_leaf_area_cm,
             est_LAI = total_est_leaf_area/10000)

skimr::skim(cogon_leaf_area)
skimr::skim(d1)


cogon_biomass <- left_join(
      cogon_biomass,
      select(plot_visit_data, installation, visit_date, plot_id,years_since_fire, installation_full_name),
      by=c("site"="installation","plot_id"))

ggplot(filter(cogon_biomass, !is.na(installation_full_name)), 
       aes(years_since_fire, tiller_density)) +
      geom_point(aes(color = installation_full_name), size = 2) +
      scale_color_brewer(palette = "Dark2") +
      theme_classic() +
      xlab("Years since fire") +
      ylab(expression(paste("Tiller density (", m^{-2}, ")"))) +
      # ggtitle("Cogongrass biomass") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/cogon-biomass.png", height = 7)

```

To quantify cogongrass biomass, we collected samples of aboveground plant material in a 25cm x 25cm area. Up to three samples were collected in each invaded area in addition to sampling done as part of the larger plot. Maximum cogongrass biomass estimated from 25cm quadrat samples from invasions at DoD installations: `r #max(cogon_biomass$biomass)`g/m^2^

```{r invaded-vs-uninvaded-biomass, eval=F}

cogon_biomass_summary <- cogon_biomass %>% 
      group_by(site, plot_id, years_since_fire) %>% 
      summarise(avg_fresh_cogon_gm2 = mean(fresh_biomass_gm2, na.rm = T),
                avg_dry_cogon_gm2 = mean(dry_biomass, na.rm = T))
# biomass_data
# biomass_data_sub
# avg_biomass_data

cogon_biomass_summary <- left_join(
      cogon_biomass_summary, select(avg_biomass_data, installation:years_since_fire, avg_dry_standing_gm2, avg_standing_gm2 ),
      by = c("site"="installation","plot_id","years_since_fire")
)

library(tidyr)
biomass_comparison <- cogon_biomass_summary %>% 
      gather(biomass_type, biomass_weight, -site, -plot_id, -years_since_fire) %>% 
      mutate(biomass_type = if_else(biomass_type=="avg_fresh_cogon_gm2","Cogongrass (wet)",
                                    if_else(biomass_type=="avg_dry_cogon_gm2", "Cogongrass (dry)",
                                            if_else(biomass_type=="avg_standing_gm2", "Native (wet)", "Native (dry)")))) 
      # ungroup(.) %>% 
      # group_by(years_since_fire, biomass_type) %>% 
      # summarise(avg_biomass = mean(biomass_weight))
biomass_comparison$biomass_type <- factor(biomass_comparison$biomass_type, levels = c("Native (wet)", "Native (dry)", "Cogongrass (wet)","Cogongrass (dry)"))

ggplot(biomass_comparison, aes(years_since_fire, biomass_weight, color = biomass_type)) +
      geom_point() +
      geom_smooth(method = "loess", se = F) +
      # invasion_color +
      theme_classic() +
      def_theme +
      ylab(ylab(expression(paste("Fuel load (g/", m^{2}, ")")))) +
      xlab("Years since fire")

```

This is a quick and dirty estimate because there may be some overlap in the data. I need to clean up the calculation be separating out quadrats that have cogongrass in the plot data.

# Compare All Quadrat Data to Subset of Data

Percent cover

 * litter
 * bare ground
 * green

Heights

 * woody vegetation (3 measurements)
 * grassy/herbaceous vegetation (3 measurements)
 * litter (depth)
 
* If there was no vegetation or litter height to measure then the first vegetation measurement was assigned a value of zero and the other two `r NA`.


We (Drew and I) have been talking about the possibility of further reducing the amount of effort expended to sample vegetation and set up the plot by revising the plot design. 

**The alternative:** We use the 12.6m circular plot with just four vegetation sampling quadrats at 10 meters. Tick traps would be placed near the outside edge of the plot in each of the cardinal directions (north, east, south, west), and one in plot center.

**The caveats:** 1. Tick trap deployment and vegetation measurements would have to be on different days. 2. We still need to do transects for dung surveys.

My first step was to see how this plays out in the data by testing for differences in means of data summarized across all quadrats (12) to data from the quadrats at 10 meters (4). I subset the data and conducted a series of t-test on the means (averaging across all the 1 meter quadrats in each data set) of woody vegetation height, herbaceous vegetation height, litter depth; and percent covers of bare ground, green vegetation, and litter. 


```{r compare all 12 quadrats to subset of 4 at 10m, eval=F }
par(mfrow=c(1,2))
hist(log(quadrat_summaries$avg_woody_ht1))
hist(log(quadrat10m_summaries$avg_woody_ht1))
t.test(log(quadrat_summaries$avg_woody_ht1),log(quadrat10m_summaries$avg_woody_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_woody_ht_all))
var(log(quadrat_summaries$avg_woody_ht_all))
hist(log(quadrat10m_summaries$avg_woody_ht_all))
var(log(quadrat10m_summaries$avg_woody_ht_all))
t.test(log(quadrat_summaries$avg_woody_ht_all),log(quadrat10m_summaries$avg_woody_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht1))
var(log(quadrat_summaries$avg_herb_ht1))
hist(log(quadrat10m_summaries$avg_herb_ht1))
var(log(quadrat10m_summaries$avg_herb_ht1))
t.test(log(quadrat_summaries$avg_herb_ht1),
       log(quadrat10m_summaries$avg_herb_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht_all))
var(log(quadrat_summaries$avg_herb_ht_all))
hist(log(quadrat10m_summaries$avg_herb_ht_all))
var(log(quadrat10m_summaries$avg_herb_ht_all))
t.test(log(quadrat_summaries$avg_herb_ht_all),
       log(quadrat10m_summaries$avg_herb_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth1))
var(log(quadrat_summaries$avg_litter_depth1))
hist(log(quadrat10m_summaries$avg_litter_depth1))
var(log(quadrat10m_summaries$avg_litter_depth1))
t.test(log(quadrat_summaries$avg_litter_depth1),
       log(quadrat10m_summaries$avg_litter_depth1), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth_all))
var(log(quadrat_summaries$avg_litter_depth_all))
hist(log(quadrat10m_summaries$avg_litter_depth_all))
var(log(quadrat10m_summaries$avg_litter_depth_all))
t.test(log(quadrat_summaries$avg_litter_depth_all),
       log(quadrat10m_summaries$avg_litter_depth_all), var.equal = T)

hist((quadrat_summaries$avg_pct_green))
var((quadrat_summaries$avg_pct_green))
hist((quadrat10m_summaries$avg_pct_green))
var((quadrat10m_summaries$avg_pct_green))
t.test((quadrat_summaries$avg_pct_green),
       (quadrat10m_summaries$avg_pct_green), var.equal = F)

hist(log(quadrat_summaries$avg_pct_litter))
var(log(quadrat_summaries$avg_pct_litter))
hist(log(quadrat10m_summaries$avg_pct_litter))
var(log(quadrat10m_summaries$avg_pct_litter))
t.test(log(quadrat_summaries$avg_pct_litter),
       log(quadrat10m_summaries$avg_pct_litter), var.equal = F)

hist(log1p(quadrat_summaries$avg_pct_bare))
var((quadrat_summaries$avg_pct_bare))
hist(log1p(quadrat10m_summaries$avg_pct_bare))
var((quadrat10m_summaries$avg_pct_bare))
t.test(log1p(quadrat_summaries$avg_pct_bare),
       log1p(quadrat10m_summaries$avg_pct_bare), var.equal = F)
```

Using all 12 qudrats we have `r #n_distinct(species_data$veg_id)` species, while using the four quadrats at 10 meters we have `r #n_distinct(species_sub$veg_id)` species. This suggests a major difference in species richness, however, some of these are as yet unidentified/grouped and are likely duplicates for both data sets. 

```{r t-test species cover quadrat subset, eval=F}
## Testing for differences in dense vs. less dense data collection
hist(log(species_data$pct_cover))
var(log(species_data$pct_cover))
hist(log(species_sub$pct_cover))
var(log(species_sub$pct_cover))
t.test(log(species_data$pct_cover), log(species_sub$pct_cover),
       var.equal = T, paired = F)
```
A t-test of the log-transformed means for percent cover indicate no statistical difference.

Based on these t-tests there were no statistical differences in the means of these variables aggregated to the plot level. 
