---
title: "Fire-Plant Invasions-TBD"
date: "`r Sys.time()`"
output: 
   html_document:
     self_contained: no
     toc: yes
---

```{r set options, echo=F}
# knitr::opts_chunk$set(fig.height = 10)
knitr::opts_chunk$set(fig.width = 7.5)
knitr::opts_chunk$set(dpi = 300)
knitr::opts_chunk$set(echo = F)
knitr::opts_chunk$set(warning = F)
knitr::opts_chunk$set(message = F)
```

```{r load libraries}
# source(plot-data.R)

library(plyr); library(dplyr); library(ggplot2); library(readr)
library(stringi)
library(tidyr)

```

```{r assign global variables}

def_theme <- theme(legend.title = element_blank(),
            legend.text = element_text(size = 18),
            legend.position = "right",
            axis.text = element_text(size = 18),
            axis.title = element_text(size = 18),
            plot.title = element_text(size = 20),
            strip.background = element_blank(),
            panel.grid = element_blank()
            )
invasion_color <- scale_color_manual(values = c("blue","darkorange"))
invasion_fill <- scale_fill_manual(values = c("blue","darkorange"))

```


```{r plot data manipulation}
# plot_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/plot_info.csv")

# plot_locations <- rgdal::readOGR("data/plot-locations.shp", verbose = F)
# plot_data <- plot_locations@data
# plot_data$fire_year <- as.integer(as.character(plot_data$fire_year))
# plot_data$years_since_fire <- 2017 - plot_data$fire_year
# plot_data <- plot_data %>%
#       filter(is.na(fire_year)==FALSE) %>%
#       mutate(plot_id = tolower(stri_sub(name, -2,-1)),
#              installation = tolower(stri_sub(name,1,-3))) %>%
#       rename(last_fire_year = fire_year) %>% 
#       select(installation, plot_id, last_fire_year, years_since_fire, imcy_inv)
# ## Add labels column for installation names
# plot_data$installation_full_name[plot_data$installation=="blanding"] <- "Camp Blanding"
# plot_data$installation_full_name[plot_data$installation=="eglin"] <- "Eglin AFB"
# plot_data$installation_full_name[plot_data$installation=="tyndall"] <- "Tyndall AFB"
# plot_data$installation_full_name[plot_data$installation=="avonpark"] <- "Avon Park AFR"
# plot_data$installation_full_name[plot_data$installation=="shelby"] <- "Camp Shelby"
# plot_data$installation_full_name[plot_data$installation=="moody"] <- "Moody AFB"

plot_data <- read_csv("data/plot_data.csv")
plot_visit_data <- read_csv("data/plot_visit_data.csv")
plot_visit_data <- left_join(plot_visit_data, 
                             select(plot_data, -description, -burn_unit_id))
plot_visit_data <- plot_visit_data[is.na(plot_visit_data$visit_date)==FALSE,]
# plot_visit_data <- arrange(plot_visit_data, desc(ycoord_lat))
# 
# plot_visit_data %>% 
#       if_else(round(ycoord_lat, digits = 1)>31, 31, 0)

```

# Installations Visited and Plots Sampled

* **`r n_distinct(plot_visit_data$installation)` installations**
* **`r n_distinct(plot_visit_data$years_since_fire)` burn units**
* **`r length(plot_visit_data$plot_id)` plots**

![](figures/DoD-installations-map2017.png)

```{r summary of plots visited, fig.width=10}

plot_visit_data$imcy_inv <- factor(plot_visit_data$imcy_inv, levels=c("uninvaded","invaded"), labels = c("Uninvaded","Invaded"))

xtabs(~ imcy_inv + years_since_fire + installation_full_name, data = plot_visit_data)

# ggplot(plot_data, aes(installation)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       ggtitle("Number of plots established at each installation") +
#       theme_classic()
# plot_data$inv_colors[plot_data$imcy_inv=="invaded"] <- "#d8b365"
# plot_data$inv_colors[plot_data$imcy_inv=="uninvaded"] <- "#5ab4ac"

ggplot(plot_visit_data, aes(installation_full_name)) +
      geom_bar(fill = "blue") +
      # facet_grid(installation_full_name ~ ., scales = "free_y") +
      ylab("Number of plots") +
      xlab("") +
      # ggtitle("Plots in Burn Units Across Installations") +
      theme_classic()
      
ggplot(plot_visit_data, aes(as.factor(years_since_fire))) +
      geom_bar(aes(fill = imcy_inv), position = "dodge") +
      invasion_fill +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("Number of plots") +
      xlab("Years since last fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      def_theme

ggplot(plot_visit_data, aes(as.factor(years_since_fire))) +
      geom_bar(aes(fill = imcy_inv), position = "dodge") +
      invasion_fill +
      facet_grid(installation_full_name~.) +
      ylab("Number of plots") +
      xlab("Years since last fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_bw() +
      def_theme

# ggplot(plot_data, aes(imcy_inv)) +
#       geom_bar() +
#       ylab("Number of plots") +
#       xlab("") +
#       ggtitle("Invaded plots: 8, Uninvaded plots: 21") +
#       theme_classic()

# ggplot(plot_visit_data, aes(ycoord_lat, years_since_fire)) +
#       geom_point(aes(color = installation, shape = imcy_inv), size = 2) +
#       # geom_bar(stat = "identity") +
#       theme_classic()

```


# Canopy Cover Data
```{r load canopy cover data}
canopy_cover <- read_csv("~/Dropbox (UF)/SERDP-Project/data/densiometer-canopy-cover.csv")

canopy_cover_summary <- canopy_cover %>%
      group_by(installation, plot_id) %>%
      summarise(avg_canopy_cover = mean(pct_canopy_cover),
                sd_canopy_cover = sd(pct_canopy_cover),
                n_obs = 12,
                se_canopy_cover = sd_canopy_cover/sqrt(n_obs))

cc_inv <- left_join(canopy_cover_summary, plot_visit_data)

ggplot(cc_inv, aes(years_since_fire, avg_canopy_cover)) +
      geom_point(aes(color = imcy_inv)) +
      # geom_bar(aes(fill = imcy_inv), stat = "identity", position = "dodge") +
      invasion_color +
      # scale_fill_discrete(h = c(249,200)) +
      ylab("% canopy cover") +
      xlab("Years since last fire") +
      # ggtitle("Invaded vs. Uninvaded Plots Across Burn Units") +
      theme_classic() +
      theme(legend.title = element_blank())

# plot_data1 <- left_join(ungroup(plot_data), ungroup(canopy_cover_summary))
# plot_data1 <- left_join(ungroup(plot_data), ungroup(quadrat_summaries))
```


# Species Data - 1-meter Quadrats

```{r load 1m quadrat data}
quadrat_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/quadrat1m.csv")
quadrat_data$date <- as.Date(as.character(quadrat_data$date), format = "%Y%m%d")
quadrat_data <- filter(quadrat_data, date > "2017-06-01")# discard early data collection at Camp Blanding

# summary(quadrat_data)

quadrat_data$woody_veg_ht1[is.na(quadrat_data$woody_veg_ht1)] <- 0
# quadrat_data$woody_veg_ht1 <- as.numeric(quadrat_data$woody_veg_ht1)
quadrat_data$herb_veg_ht1[is.na(quadrat_data$herb_veg_ht1)] <- 0
# quadrat_data$herb_veg_ht1 <- as.numeric(quadrat_data$herb_veg_ht1)
quadrat_data$pct_green[quadrat_data$pct_green=="<1"] <- 0.5
quadrat_data$pct_green <- as.numeric(quadrat_data$pct_green)
```

```{r summarize 1m quadrat data}
quadrat_summaries <- quadrat_data %>%
      group_by(installation, plot_id) %>%
      summarise(
            avg_woody_ht1 = mean(woody_veg_ht1),
            avg_woody_ht_all = mean(
                  c(woody_veg_ht1,woody_veg_ht2,woody_veg_ht3), na.rm = T),
            avg_herb_ht1 = mean(herb_veg_ht1),
            avg_herb_ht_all = mean(c(herb_veg_ht1, herb_veg_ht2, herb_veg_ht3), na.rm = T),
            avg_litter_depth1 = mean(litter_ht1),
            avg_litter_depth_all =
                  mean(c(litter_ht1,litter_ht2,litter_ht3), na.rm = T),
            avg_pct_green = mean(pct_green),
            avg_pct_litter = mean(pct_litter),
            avg_pct_wood = mean(pct_wood_litter),
            avg_pct_bare = mean(pct_bare))

quadrat_summaries <- left_join(
      quadrat_summaries,
      select(plot_visit_data, installation:installation_full_name),
      by = c("installation","plot_id")
)

quadrat10m_summaries <- quadrat_data %>%
      filter(quadrat_id == "n10"|quadrat_id == "e10"|quadrat_id=="s10"|quadrat_id=="w10") %>%
      group_by(installation, plot_id) %>%
      summarise(
            avg_woody_ht1 = mean(woody_veg_ht1),
            avg_woody_ht_all = mean(
                  c(woody_veg_ht1,woody_veg_ht2,woody_veg_ht3), na.rm = T),
            avg_herb_ht1 = mean(herb_veg_ht1),
            avg_herb_ht_all = mean(c(herb_veg_ht1, herb_veg_ht2, herb_veg_ht3), na.rm = T),
            avg_litter_depth1 = mean(litter_ht1),
            avg_litter_depth_all =
                  mean(c(litter_ht1,litter_ht2,litter_ht3), na.rm = T),
            avg_pct_green = mean(pct_green),
            avg_pct_litter = mean(pct_litter),
            avg_pct_wood = mean(pct_wood_litter),
            avg_pct_bare = mean(pct_bare))

# summary(quadrat_summaries)
# summary(quadrat10m_summaries)
```

```{r load species data}
species_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/species1m.csv")
species_data$date <- as.Date(as.character(species_data$date), format = "%Y%m%d")
species_data <- filter(species_data, date>"2017-06-01")
species_data$veg_id <- tolower(species_data$veg_id)
# species_data <- rename(species_data, sci_name = scientific_name)


species_table <- read_csv("data/plant_species_list.csv")
species_table$species[is.na(species_table$species)] <- ""
species_table$scientific_name <- paste(
      species_table$genus, species_table$species, sep = " ")

# species_table %>% arrange(scientific_name)
# 
# length(unique(species_data$scientific_name))
# sort(unique(species_data$scientific_name))
# n_distinct(species_data$veg_id)
# sort(unique(species_data$veg_id))


# species_data <- left_join(species_data, species_table, by = c("veg_id"="code"))


# unique(species_data$scientific_name)
dsub <- select(species_data, veg_id, scientific_name, pct_cover) %>% 
      filter(scientific_name=="-", pct_cover < 10)
# sort(unique(dsub$veg_id))
# filter(species_data, veg_id=="shrub 11:29")
# filter(species_data, veg_id=="tls")


# species_data$scientific_name[species_data$veg_id=="qula"] <- "Quercus laevis"
# species_data$scientific_name[species_data$veg_id=="wiregrass"] <- "Aristida stricta"
# species_data$scientific_name[species_data$veg_id=="limi"] <- "Licania michauxii"
# species_data$scientific_name[species_data$veg_id=="pipa"] <- "Pinus palustris"
# species_data$scientific_name[species_data$veg_id=="quni"] <- "Quercus nigra"
# species_data$scientific_name[species_data$veg_id=="rhco"] <- "Rhus copallinum"
# species_data$scientific_name[species_data$veg_id=="moce"] <- "Morella cerifera"
# species_data$scientific_name[species_data$veg_id=="qula2"] <- "Quercus laurifolia"
# species_data$scientific_name[species_data$veg_id=="quge"] <- "Quercus geminata"
# species_data$scientific_name[species_data$veg_id=="divi"] <- "Diospyros virginiana"
# species_data$scientific_name[species_data$veg_id=="quge"] <- "Quercus geminata"

# filter(species_data, veg_id=="sf" # scientific_name!="NA",
#        )


species_data <- left_join(species_data, plot_visit_data, 
                           by = c("installation","plot_id"))
# summary(species_data)

species_sub <- (filter(species_data, quadrat_id %in% c("e10","w10","n10","s10")))
# n_distinct(species_sub$scientific_name)
# sort(unique(species_sub$scientific_name))
# summary(species_sub)

```

## Understory vegetation cover
```{r average species cover, fig.height=9}
# datac$se <- datac$sd / sqrt(datac$N)
# species_data$imcy_inv <- factor(species_data$imcy_inv, levels = c("uninvaded","invaded"))

## Create data frame of vegetation cover averaged across plots, burn units, and installations
avg_species_cover <- species_data %>%
             group_by(installation_full_name, plot_id, imcy_inv, years_since_fire, quadrat_id) %>%
      summarise(veg_cover = sum(pct_cover)) %>% 
      ungroup(.) %>% 
      group_by(installation_full_name, plot_id, imcy_inv, years_since_fire) %>%
             summarise(avg_veg_cover = mean(veg_cover),
                       # n_obs = length(veg_id),
                       max_veg_cover = max(veg_cover),
                       se_veg_cover = sd(veg_cover)/sqrt(length(veg_cover)))

ggplot(avg_species_cover,
      aes(as.factor(years_since_fire), avg_veg_cover, fill = imcy_inv)) +
      geom_bar(stat = "identity", position = "dodge") +
      invasion_fill +
      geom_errorbar(aes(ymin = avg_veg_cover + se_veg_cover, ymax = avg_veg_cover - se_veg_cover),
                    width = .2, position=position_dodge(width = .9)) +
      facet_grid(installation_full_name~.) +
      theme_bw() +
      ylab("Vegetation cover (%)") +
      xlab("Years since fire") +
      ggtitle("Understory vegetation cover from 1-meter quadrats") +
      theme(legend.title = element_blank(),
            strip.background = element_blank())

# ggsave("~/Dropbox (UF)/SERDP-Project/figures/avg-pct-cover-bars.png", height = 7)
```


## Understory species richness
```{r species richness}
# species_sub <- (filter(species_data2, !quadrat_id %in% c("w2","w4","n2","n4","s2","s4","e2","e4")))
# species_sub_plot <- ggplot(species_sub %>%
#                              filter(pct_cover > 5) %>%
#                              group_by(plot_id, veg_id) %>%
#                              summarise(avg_pct_cover = mean(pct_cover),
#                                        occurrence = length(veg_id)),
#       aes(veg_id,avg_pct_cover, label = occurrence))

# species_sub_plot +
#       geom_bar(stat = "identity") +
#       facet_grid(plot_id ~.) +
#       theme_classic() +
#       ggtitle("12 quadrats per plot")

      # dbh_census_years %>%
      # group_by(sample_year, speciesid, stem_status) %>%
      # summarise(occurrence = length(unique(plotid))) %>%
      # arrange(desc(occurrence))

# head(species_data)

species_richness <- species_data %>%
      group_by(installation, years_since_fire, imcy_inv) %>%
      summarise(richness = n_distinct(scientific_name)) %>% 
      mutate(ln_richness = log(richness))

invaded_quadrats <- species_data %>% 
      filter(scientific_name=="Imperata cylindrica") %>% 
      mutate(quadrat_invaded = "yes") %>% 
      select(installation:quadrat_id, quadrat_invaded, years_since_fire, installation_full_name)

species_data <- left_join(species_data, invaded_quadrats)
species_data$quadrat_invaded[is.na(species_data$quadrat_invaded)] <- "no"

quadrat_species_richness <- species_data %>%
      group_by(installation_full_name, years_since_fire, quadrat_invaded, quadrat_id) %>%
      summarise(richness = length(unique(veg_id))) %>% 
      mutate(ln_richness = log(richness),
             invasion_status = factor(quadrat_invaded, levels = c("no","yes"), labels = c("Uninvaded","Invaded")))

```

There were `r length(invaded_quadrats$quadrat_invaded)` (`r round(100*length(invaded_quadrats$quadrat_invaded)/length(quadrat_species_richness$richness), digits = 1)` %) 1-m quadrats located in invaded areas representing `r n_distinct(invaded_quadrats$years_since_fire)` different years since fire at `r n_distinct(invaded_quadrats$installation)` different installations (`r unique(invaded_quadrats$installation_full_name)`).

```{r quadrat richness}

## All points
# ggplot(quadrat_species_richness, aes(years_since_fire, richness, color = invasion_status)) +
#       # geom_boxplot(notch = F) +
#       geom_point(position = "jitter") +
#       invasion_color +
#       invasion_fill +
#       geom_smooth(show.legend = F, alpha = .2, aes(fill = invasion_status)) +
#       # facet_grid(.~installation) +
#       theme_classic() +
#       xlab("") +
#       ylab("Richness") +
#       ggtitle("Quadrat-level species diversity")


ggplot(quadrat_species_richness, aes(years_since_fire, richness, color = invasion_status)) +
      # geom_boxplot(aes(fill = quadrat_invaded), position = "dodge") +
      geom_smooth(show.legend = F, alpha = .2, aes(fill = invasion_status)) +
      stat_summary(fun.y = "mean", geom = "point") +
      stat_summary(fun.data = "mean_se", geom = "pointrange", alpha = .5) +
      invasion_color +
      invasion_fill +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire") +
      ggtitle("Quadrat-level species diversity")
```


```{r plot richness}
ggplot(species_richness, aes(years_since_fire, richness)) +
      # stat_summary(aes(y = richness), fun.data = "mean_se", "pointrange") +
      geom_point(position = "jitter") +
      geom_smooth(alpha = .1, color = "black") +
      invasion_color +
      theme_classic() +
      xlab("Years since fire") +
      ylab("Richness") +
      ggtitle("Plot-level species diversity") 

```

There is no clear effect of cogongrass invasion on diversity in these data, however, the representation of invasion is very small within each time since fire grouping. In two cases we have only a single sampling point, so no estimate of variation. We do see a non-linear relationship with the time since last fire, where richness is initially highest a few months following a fire, then decreases for 1-2 years before increasing small amount and then declining again after about 6 years after the last fire.

```{r 5pct species cover, eval=F}
species_over_5pct <- filter(species_data, pct_cover>5)
# species_sub_over_5pct <- filter(species_sub_over_5pct, cogongrass != "NA")

ggplot(species_over_5pct,
       aes(years_since_fire, pct_cover, color = scientific_name)) +
      geom_point(position="jitter") +
      theme_classic() +
      def_theme +
      facet_grid(installation~imcy_inv) +
      ylab("% cover") +
      xlab("Years since fire") +
      ggtitle("Range of species cover (>5%) at 1-meter quadrats")
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/species-pct-cover.png", height = 7)
```

# Tree Data

```{r load tree data}

tree_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/tree-data.csv")
# tree_data
tree_data$date <- as.Date(as.character(tree_data$date), format = "%Y%m%d")

tree_data <- filter(tree_data, date>"2017-06-01", plot_id != "bland03", plot_id != "bland02")  
tree_data$plot_id <- tolower(tree_data$plot_id)

tree_data <- left_join(
      tree_data,
      plot_visit_data,
      by = c("installation","plot_id")) %>% 
      mutate(genus = "",
             labels = "")

# sort(unique(tree_data$species))
tree_data$species[tree_data$species=="divi5"] <- "divi"
# tree_data$genus <- tree_data$species

tree_data$genus[tree_data$species=="divi"] <- "Diospyros"
tree_data$genus[tree_data$species=="cr"] <- "Crataegus"
tree_data$genus[tree_data$species=="acru"] <- "Acer"
tree_data$genus[tree_data$species=="sweetgum"] <- "Liquidambar"
tree_data$genus[agrep("qu", tree_data$species, max.distance = 0)] <- "Quercus"
tree_data$genus[agrep("pi", tree_data$species, max.distance = 0)] <- "Pinus"
tree_data$genus[is.na(tree_data$species)] <- "Unknown (dead)"
tree_data$labels <- tree_data$genus
tree_data$labels[!(tree_data$labels %in% c("Quercus","Pinus"))] <- "Other"

tree_data$imcy_inv <- factor(tree_data$imcy_inv, levels = c("Uninvaded","Invaded"))

tree_data_summary <- tree_data %>% 
      group_by(installation_full_name, years_since_fire, imcy_inv) %>% 
      mutate(basal_area_ha = (pi*((.5*dbh/100)^2))/.05) %>% 
      summarise(richness = n_distinct(species),
                avg_basal_area = mean(basal_area_ha))
# skimr::skim(tree_data)
```

## Tree richness
```{r tree richness}

tree_richness <- tree_data %>% 
      group_by(installation_full_name, years_since_fire, imcy_inv) %>% 
      summarise(richness = n_distinct(species))

ggplot(tree_richness, aes(years_since_fire, richness, color = imcy_inv)) +
      geom_point(position = position_jitter(height = .1, width = .3)) +
      invasion_color +
      invasion_fill +
      # facet_grid(installation_full_name~.) +
      theme_classic() +
      def_theme +
      ylab("Richness") +
      xlab("Years since fire") +
      ggtitle("Tree diversity vs. time since fire")

```

## Tree basal area
```{r tree basal area}
basal_area_data <- tree_data %>%
      group_by(installation_full_name, labels, years_since_fire) %>%
      mutate(basal_area_ha = (pi*((.5*dbh/100)^2))/.05) %>% 
      summarise(total_basal_area_ha = sum(basal_area_ha),
                avg_basal_area_ha = mean(basal_area_ha),
                se_basal_area_ha = sd(basal_area_ha)/sqrt(length(basal_area_ha)))


ggplot(basal_area_data, aes(years_since_fire, total_basal_area_ha)
       ) +
      geom_point(aes(color = labels)) +
      geom_smooth(aes(color = labels), linetype = "dashed", se = F) +
      # geom_violin(aes(labels, dbh, fill = labels)) +
      # geom_dotplot(aes(labels, dbh, fill = labels),
      #            binaxis = "y",         # which axis to bin along
      #            binwidth = 0.4,       # Minimal difference considered diffeerent
      #            stackdir = "center"    # Centered
      #            ) +
      # geom_bar(aes(fill = labels), stat = "identity", position = "dodge") +
      # geom_errorbar(aes(ymin = avg_basal_area_ha + se_basal_area_ha, ymax = avg_basal_area_ha - se_basal_area_ha), width = .2, position = position_dodge(width = .5)) +
      scale_color_brewer(palette = "Dark2") +
      # facet_grid(installation_full_name~.) +
      # theme_classic() +
      theme_bw() +
      # xlab("Years since fire") +
      # ylab(expression(paste("Basal Area (", m^{2}, " ", ha^{-1}, ")"))) +
      # ggtitle("Total tree basal area by species") +
      def_theme 
```

## Tree dbh
```{r tree dbh}

ggplot(tree_data %>%
             group_by(installation_full_name, labels, years_since_fire, imcy_inv),
       aes(as.factor(years_since_fire), dbh, color = labels)) +
      geom_point(position = "jitter") +
      scale_fill_brewer(palette = "Dark2") +
      scale_color_brewer(palette = "Dark2") +
      facet_grid(installation_full_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Diameter at breast height") +
      def_theme +
      theme(strip.background = element_blank(),
            panel.grid = element_blank())
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-dbh-jitter.png", height=7)
```

## Tree height
```{r tree height}
# tree_height <- tree_data %>%
#       group_by(installation_full_name, labels, years_since_fire, imcy_inv) 

ggplot(tree_data,
       aes(years_since_fire, height, color = labels)) +
      # stat_summary(fun.data = "mean_se", geom = "pointrange") +
      geom_point(position = "jitter") +
      scale_color_brewer(palette = "Dark2") +
      facet_grid(installation_full_name~imcy_inv) +
      theme_bw() +
      xlab("Years since fire") +
      ylab("Tree height") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/tree-height-jitter.png", height=7)

```

# Biomass data sampled at 25cm quadrats

```{r 25cm biomass data}
biomass_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/quadrat25cm.csv")
biomass_data$date <- as.Date(as.character(biomass_data$date), format="%Y%m%d")
biomass_data <- filter(biomass_data, date>"2017-04-25", plot_id!="bland02", plot_id!="bland03")
# summary(biomass_data)
biomass_data$standing_fuel_mass_wet <- round(
      biomass_data$standing_fuel_mass_wet, 2)

biomass_data <- left_join(
      select(biomass_data, installation, plot_id, standing_fuel_ht:standing_biomass_type),
      select(plot_visit_data, installation:installation_full_name),
      by = c("installation","plot_id")) %>% 
      mutate(pct_std_moisture = 
                   100*(standing_fuel_mass_wet - standing_fuel_mass_dry)/standing_fuel_mass_wet,
             pct_lit_moisture = 
                   100*(litter_mass_wet - litter_mass_dry)/litter_mass_wet)

# biomass_data$last_fire_year <- as.integer(biomass_data$last_fire_year)
# biomass_data$years_since_fire <- 2017 - biomass_data$last_fire_year

avg_biomass_data <- biomass_data %>% 
      group_by(installation, plot_id, years_since_fire) %>% 
      mutate(standing_gm2 = standing_fuel_mass_wet*16,
             litter_gm2 = litter_mass_wet*16,
             dry_standing_gm2 = standing_fuel_mass_dry*16,
             dry_litter_gm2 = litter_mass_dry*16) %>% 
      summarise(avg_standing_gm2 = mean(standing_gm2),
                avg_litter_gm2 = mean(litter_gm2),
                se_standing = sd(standing_gm2)/sqrt(length(standing_gm2)),
                se_litter = sd(litter_gm2)/sqrt(length(litter_gm2)),
                avg_dry_standing_gm2 = mean(dry_standing_gm2),
                se_dry_standing_gm2 = sd(dry_standing_gm2)/sqrt(length(dry_standing_gm2)),
                avg_dry_litter_gm2 = mean(dry_litter_gm2),
                se_litter = sd(dry_litter_gm2)/sqrt(length(dry_litter_gm2)))
```

```{r standing biomass fig}
ggplot(biomass_data,
       aes(years_since_fire, standing_fuel_mass_wet*16, color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      # facet_grid(.~installation) +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .1) +
      theme_classic() +
      ylab(expression(paste("Standing biomass (g/", m^{2}, ")"))) +
      xlab("Years since last fire") +
      ggtitle("Fresh standing biomass across burn units at each installation",
              subtitle = "(measurements at 25cm quadrats)") +
      theme(legend.title = element_blank()) +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/standing-biomass-hitter.png", height=7)
```

```{r litter biomass fig}
ggplot(biomass_data,
        aes((years_since_fire), litter_mass_wet*16, color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = T, alpha = .1) +
      # facet_grid(.~installation) +
      theme_classic() +
      ylab(expression(paste("Litter biomass (g/", m^{2}, ")"))) +
      xlab("Years since last fire") +
      ggtitle("Fresh litter biomass across burn units",
              subtitle = "(measurements at 25cm quadrats)") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/litter-biomass-jitter.png", height=7)
```


# Host Abundance Estimates

```{r dung data}
dung_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/dung.csv")
dung_data$plot_id <- tolower(dung_data$plot_id)
dung_data$species <- tolower(dung_data$species)
dung_data$location <- tolower(dung_data$location)
dung_data <- left_join(dung_data, plot_visit_data)
# dung_data <- rename(dung_data, clusters1m = `1m`, clusters2m = `2m`)
dung_data_avg <- dung_data %>% 
      group_by(installation, plot_id) %>% 
      summarise(avg_clusters1m = mean(dung1m))
dung_data_avg <- left_join(dung_data_avg, plot_visit_data)
# skimr::skim(dung_data_avg)
```

```{r dung fig}

ggplot(dung_data, 
       aes((years_since_fire), (dung1m), color = installation)) +
      geom_point(size = 2) +
      # invasion_color +
      invasion_fill +
      geom_smooth(aes(linetype = imcy_inv), se = F, alpha = .1, linetype = "dashed") +
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .1, method = "lm") +
      # geom_bar(aes(fill = installation), stat = "identity", position = "dodge") +
      theme_classic() +
      ylab("Number of dung clusters (log)") +
      xlab("Years since fire") +
      # ylab("Dung clusters") +
      def_theme

```


# Tick Abundance

```{r tick data QC}

tick_data <- read_csv("~/Dropbox (UF)/SERDP-Project/data/ticks.csv")

tick_data$plot_id <- tolower(tick_data$plot_id)
tick_data$plot_id[tick_data$plot_id=="c"] <- "c1"
# tick_data$Date <- as.Date(tick_data$Date, format = "%Y-%m-%d-")
tick_data$excel_date <- gsub("-","",tick_data$date)
write_csv(tick_data, "data/tick-data.csv")

tick_data <- left_join(tick_data, plot_visit_data, 
                       by = c("installation", "plot_id"))
# summary(tick_data)
# filter(tick_data, is.na(years_since_fire))
# "extra" ticks at Moody AFB were from an area last burned in 2005
tick_data$years_since_fire[tick_data$installation=="moody"] <- 2017-2005
tick_data <- tick_data[is.na(tick_data$years_since_fire)==FALSE,]
tick_data$installation_full_name[tick_data$installation=="moody"] <- "Moody AFB"

tick_data$date <- as.Date(as.character(tick_data$date), format = "%Y%m%d")

```


## Total ticks collected across burn units 

The high tick abundance for 8-years post-fire is driven by a single plot at Camp Blanding.

```{r tick-abundance-fire-summary}

ggplot(tick_data, aes(factor(years_since_fire), count)) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      # geom_violin(aes(fill = imcy_inv)) +
      # geom_dotplot(aes(fill = imcy_inv),
      #            binaxis = "y",         # which axis to bin along
      #            binwidth = .5,       # Minimal difference considered diffeerent
      #            stackdir = "center"    # Centered
      #            ) +
      # geom_bar(fill = "blue", stat = "identity", position = "dodge") +
      
      # facet_grid(installation~., scales = "free_y") +
      xlab("Years since fire") +
      ylab("Tick abundance") +
      theme_classic() +
      def_theme

# ggplot(tick_data, aes(as.factor(years_since_fire), count)) +
#       stat_summary(fun.data = "mean_se",geom = "pointrange") +
#       xlab("Years since fire") +
#       ylab("Tick abundance") +
#       theme_classic() +
#       def_theme

```

## Tick species

**Note the different scales of the y-axes**

```{r tick-species-fig, fig.height=9}
ggplot(tick_data %>%
             group_by(installation_full_name, years_since_fire, species) %>%
             summarise(tick_number = sum(count)),
       aes(as.factor(years_since_fire), tick_number, fill = species)) +
      # geom_point(position = "jitter") +
      geom_bar(stat = "identity", position = "dodge") +
      scale_fill_brewer(palette = "Set1") +
      facet_grid(installation_full_name~., scales = "free_y") +
      xlab("Years since fire") +
      ylab("Tick abundance") +
      theme_bw() +
      def_theme
```

```{r summarize-tick-abundance-data}
tick_data_sum <- tick_data %>% 
      group_by(installation, plot_id, installation_full_name, years_since_fire) %>% 
      summarise(total_ticks = sum(count))
biomass_data_sub <- ungroup(avg_biomass_data) %>% 
      select(installation:avg_litter_gm2)

# plot_data
tick_data_sum <- left_join(plot_visit_data, tick_data_sum)
tick_data_sum$total_ticks[is.na(tick_data_sum$total_ticks)] <- 0
tick_data_sum <- left_join(tick_data_sum, biomass_data_sub)
tick_data_sum <- left_join(tick_data_sum, select(avg_species_cover, installation_full_name:max_veg_cover))
tick_data_sum <- left_join(tick_data_sum, quadrat_summaries)
tick_data_sum <- left_join(tick_data_sum, 
                select(canopy_cover_summary, installation:avg_canopy_cover)
                )
tick_data_sum <- left_join(tick_data_sum, select(dung_data_avg, installation:avg_clusters1m))

unique(tick_data_sum$installation_full_name)
unique(tree_data_summary$installation_full_name)
tick_data_sum <- left_join(tick_data_sum, tree_data_summary)

tick_data_sum$imcy_inv <- factor(tick_data_sum$imcy_inv, levels = c("Uninvaded","Invaded"), labels = c("Uninvaded","Invaded"))

# skimr::skim(tick_data_sum)
```


## Tick~fire log-linear relationship 
```{r tick-fire}

ggplot(tick_data_sum, aes(years_since_fire, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = F, method = "loess", alpha = .2) +
      # geom_smooth(aes(color = imcy_inv), method = "loess",
                  # linetype = "dashed", se = F) +
      theme_classic() +
      xlab("Years since fire") +
      ylab("Tick abundance (log)") +
      def_theme

```


## Seasonal sampling

```{r tick-abundance-by-date}

tick_data$week <- lubridate::week((tick_data$date))
ggplot(tick_data %>% 
             group_by(date, installation_full_name) %>% 
             summarise(abundance = sum(count)),
       aes(date, abundance)) +
      # geom_point(aes(color = installation), size = 2) +
      geom_bar(aes(fill = installation_full_name), stat = "identity") +
      scale_fill_brewer(type = "div") +
      scale_x_date(limits = c(as.Date("2017-06-06"),as.Date("2017-10-01"))) +
      # geom_smooth() +
      theme_classic() +
      ylab("Tick abundance") +
      xlab("") +
      def_theme +
      theme(legend.position = c(.8, .85),
            legend.background = element_rect(color="black"))
      
```



## Tick abundance vs. latitude

No relationship, which is expected, though our range of latitude is very small. I plan to use an actual climate variable in the model, e.g. PRISM 30-year normals, WorldClim, DayMet, or possibly data from local weather stations.

```{r tick-abundance-latitude, eval=F}

ggplot(tick_data_sum, aes(ycoord_lat, log1p(total_ticks), color = imcy_inv)) +
      geom_point(position = "jitter") +
      invasion_color +
      invasion_fill + 
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "lm") +
      geom_smooth(aes(color = imcy_inv), method = "loess",
                  linetype = "dashed", se = F) +
      theme_classic() +
      xlab("Latitude") +
      ylab("Tick Abundance") +
      def_theme

```


# Tick abundance vs. plot-level averages

## Understory vegetation cover
```{r tick-veg-cover}

ggplot(tick_data_sum, aes(avg_veg_cover, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      # geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "lm") +
      geom_smooth(aes(color = imcy_inv), method = "loess",
                  linetype = "dashed", se = F) +
      theme_classic() +
      xlab("Average vegetation cover (%)") +
      ylab("Tick abundance") +
      def_theme

```


## Understory biomass 
Log-linear relationship, very noisy trends with many zeroes. 

```{r tick-veg-biomass}

ggplot(tick_data_sum, aes((avg_standing_gm2), log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess") +
      theme_classic() +
      xlab(expression(paste("Average biomass (g/", m^{2}, ")"))) +
      ylab("Tick abundance (log)") +
      ggtitle("Understory standing biomass") +
      def_theme

# summary(glm(total_ticks ~ avg_standing_gm2, data = tick_data_sum, family = "quasipoisson"))

```


## Litter percent cover
```{r tick-litter-cover}

ggplot(tick_data_sum, aes(avg_pct_litter, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess") +
      theme_classic() +
      xlab(expression(paste("Litter cover (%)"))) +
      ylab("Tick abundance (log)") +
      def_theme

```


## Litter biomass
```{r tick-litter-mass}

ggplot(tick_data_sum, aes(avg_litter_gm2, log1p(total_ticks), color = imcy_inv)) +
      geom_point(position = "jitter") +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess") +
      theme_classic() +
      xlab(expression(paste("Biomass (g/", m^{2}, ")"))) +
      ylab("Tick abundance (log)") +
      ggtitle("Litter biomass") +
      def_theme

```

## Canopy cover
Log-linear relationship, where there are more ticks in plots with more canopy cover.
```{r tick-canopy-cover}

ggplot(tick_data_sum, aes(avg_canopy_cover, log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess") +
      theme_classic() +
      xlab(expression(paste("Canopy cover (%)"))) +
      ylab("Tick abundance (log)") +
      def_theme

```

## Estimated host abundance
Log-log relationship
```{r tick-hosts}

ggplot(tick_data_sum, aes(log1p(avg_clusters1m), log1p(total_ticks), color = imcy_inv)) +
      geom_point() +
      invasion_color +
      invasion_fill +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "lm") +
      geom_smooth(aes(fill = imcy_inv), se = F, alpha = .2, method = "loess", linetype = "dashed") +
      geom_smooth(method = "lm", color = "gray50", se = F) +
      theme_classic() +
      xlab(expression(paste("Average # of dung clusters (log)"))) +
      ylab("Tick abundance (log)") +
      def_theme

```

Loess lines are dashed, lines from the linear model are solid, and the gray solid line is the overall trend when pooling the data across invaded and uninvaded plots.

# Initial/exploratory linear (OLS) models
```{r linear models ticks}
summary(lm(log1p(total_ticks) ~ years_since_fire, data = tick_data_sum))
summary(lm(log1p(total_ticks) ~ avg_litter_gm2, data = tick_data_sum))
summary(lm(avg_litter_gm2 ~ years_since_fire, data = tick_data_sum))
summary(lm(log1p(total_ticks) ~ avg_canopy_cover, data = tick_data_sum))
```

```{r ggpairs plot}
# install.packages("GGally")
library(GGally)
library(GGally)
ggpairs(select(tick_data_sum, years_since_fire, ycoord_lat, total_ticks, avg_litter_gm2:avg_veg_cover, avg_pct_bare:avg_basal_area)) +
      theme(panel.grid = element_blank())

pairs(select(tick_data_sum, years_since_fire, ycoord_lat, total_ticks:avg_basal_area))
```


```{r path model structure}
library(piecewiseSEM)
library(lme4)
#glmmadmb

## Should make an explicit random-effect for the plot for clarity, by combining installation with plot_id

model_list <- list(
      tick_mod <- glmer.nb(total_ticks ~ avg_clusters1m + avg_pct_bare + avg_basal_area + years_since_fire + avg_veg_cover + (1|installation/plot_id), data = tick_data_sum),
      div_mod <- lm(log1p(richness) ~ years_since_fire, data = tick_data_sum),
      bare_grnd_mod <- lmer(avg_pct_bare ~ years_since_fire + (1|years_since_fire) + (1|installation), data = tick_data_sum),
      basal_area_mod <- lmer(avg_basal_area ~ years_since_fire + (1|years_since_fire) + (1|installation), data = tick_data_sum),
      # canopy_mod <- lmer(avg_canopy_cover ~ years_since_fire + + (1|installation) + (1|plot_id), data = tick_data_sum),
      lat_mod <- lmer(years_since_fire ~ ycoord_lat + (1|installation), tick_data_sum)
)

sem.fit(model_list, data = tick_data_sum, conditional = F)
sem.coefs(model_list, data = tick_data_sum, standardize = 'none')
sem.model.fits(model_list, aicc = T)
```


# Host abundance
We really just didn't find very much host evidence, and for the most part it is uniform across canopy cover.

```{r hosts-canopy-cover}

 ggplot(tick_data_sum, aes(avg_canopy_cover, log1p(avg_clusters1m))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      theme_classic() +
      xlab(expression(paste("Canopy cover (%)"))) +
      ylab("Dung clusters (log)") +
      def_theme

```

```{r host-trees, eval=F}
ggplot(tick_data_sum, aes(avg_basal_area, (avg_clusters1m))) +
      geom_point(aes(color = imcy_inv)) +
      invasion_color +
      geom_smooth(aes(color = imcy_inv), method = "lm", se = F) +
      theme_classic() +
      xlab(expression(paste("Canopy cover (%)"))) +
      ylab("Dung clusters (1m)") +
      def_theme
```


# Cogongrass Data Sampled from Invasions

```{r cogongrass data, eval=T}
cogon_data <- read_csv("data/raw_data/cogon-data.csv")
cogon_biomass <- cogon_data %>%
      # select(site,plot_id,Quad,fresh_biomass) %>%
      filter(site!="NA") %>%
      mutate(fresh_biomass_gm2 = fresh_biomass*16,
             dry_biomass_gm2 = dry_biomass*16)

d1 <- cogon_data %>% 
      mutate(avg_height = rowMeans(cbind(height1,height2,height3)),
             avg_width = rowMeans(cbind(width_1,width_2,width_3))) %>% 
      select(site:CogonSampleID,tiller_density,avg_height,avg_width) %>%
      mutate(est_leaf_area_cm = avg_height*avg_width*tiller_density,
             est_LAI = est_leaf_area_cm/10000)


cogon_ht <- cogon_data %>% 
      select(site:height3) %>% 
      mutate(id = as.integer(seq(1,23,1))) %>% 
      gather(key = fid, value = height_cm, -site, -plot_id, -Quadrant, -CogonSampleID, -id) %>% 
      select(-fid,-id)

cogon_width <- cogon_data %>% 
      select(site:CogonSampleID,width_1:width_3) %>% 
      mutate(id = as.integer(seq(1,23,1))) %>% 
      gather(key = fid, value = width_cm, -site, -plot_id, -Quadrant, -CogonSampleID, -id) %>% 
      select(width_cm)

cogon_ht_width <- bind_cols(cogon_ht, cogon_width) %>% 
      mutate(est_leaf_area_cm = height_cm*width_cm)
summary(cogon_ht_width)

cogon_leaf_area <- left_join(
      select(cogon_data, site:CogonSampleID,tiller_density),
      cogon_ht_width %>%
      group_by(site,plot_id,Quadrant,CogonSampleID) %>% 
      summarise(avg_est_leaf_area_cm = mean(est_leaf_area_cm))
) %>% 
      mutate(total_est_leaf_area = tiller_density*avg_est_leaf_area_cm,
             est_LAI = total_est_leaf_area/10000)

skimr::skim(cogon_leaf_area)
skimr::skim(d1)



cogon_biomass <- left_join(
      cogon_biomass,
      select(plot_visit_data, installation, visit_date, plot_id,years_since_fire, installation_full_name),
      by=c("site"="installation","plot_id"))

ggplot(cogon_biomass, aes(years_since_fire, fresh_biomass_gm2)) +
      geom_point(aes(color = installation_full_name), size = 2) +
      scale_color_brewer(palette = "Dark2") +
      theme_classic() +
      xlab("Years since fire") +
      ylab(expression(paste("Standing biomass fresh weight (g/", m^{2}, ")"))) +
      ggtitle("Cogongrass biomass") +
      def_theme
# ggsave("~/Dropbox (UF)/SERDP-Project/figures/cogon-biomass.png", height = 7)

```

To quantify cogongrass biomass, we collected samples of aboveground plant material in a 25cm x 25cm area. Up to three samples were collected in each invaded area in addition to sampling done as part of the larger plot. Maximum cogongrass biomass estimated from 25cm quadrat samples from invasions at DoD installations: `r max(cogon_biomass$biomass)`g/m^2^

```{r invaded-vs-uninvaded-biomass}

cogon_biomass_summary <- cogon_biomass %>% 
      group_by(site, plot_id, years_since_fire) %>% 
      summarise(avg_fresh_cogon_gm2 = mean(fresh_biomass_gm2, na.rm = T),
                avg_dry_cogon_gm2 = mean(dry_biomass, na.rm = T))
# biomass_data
# biomass_data_sub
# avg_biomass_data

cogon_biomass_summary <- left_join(
      cogon_biomass_summary, select(avg_biomass_data, installation:years_since_fire, avg_dry_standing_gm2, avg_standing_gm2 ),
      by = c("site"="installation","plot_id","years_since_fire")
)

library(tidyr)
biomass_comparison <- cogon_biomass_summary %>% 
      gather(biomass_type, biomass_weight, -site, -plot_id, -years_since_fire) %>% 
      mutate(biomass_type = if_else(biomass_type=="avg_fresh_cogon_gm2","Cogongrass (wet)",
                                    if_else(biomass_type=="avg_dry_cogon_gm2", "Cogongrass (dry)",
                                            if_else(biomass_type=="avg_standing_gm2", "Native (wet)", "Native (dry)")))) 
      # ungroup(.) %>% 
      # group_by(years_since_fire, biomass_type) %>% 
      # summarise(avg_biomass = mean(biomass_weight))
biomass_comparison$biomass_type <- factor(biomass_comparison$biomass_type, levels = c("Native (wet)", "Native (dry)", "Cogongrass (wet)","Cogongrass (dry)"))

ggplot(biomass_comparison, aes(years_since_fire, biomass_weight, color = biomass_type)) +
      geom_point() +
      geom_smooth(method = "loess", se = F) +
      # invasion_color +
      theme_classic() +
      def_theme +
      ylab(ylab(expression(paste("Fuel load (g/", m^{2}, ")")))) +
      xlab("Years since fire")

```

This is a quick and dirty estimate because there may be some overlap in the data. I need to clean up the calculation be separating out quadrats that have cogongrass in the plot data.

# Compare All Quadrat Data to Subset of Data

Percent cover

 * litter
 * bare ground
 * green

Heights

 * woody vegetation (3 measurements)
 * grassy/herbaceous vegetation (3 measurements)
 * litter (depth)
 
* If there was no vegetation or litter height to measure then the first vegetation measurement was assigned a value of zero and the other two `r NA`.


We (Drew and I) have been talking about the possibility of further reducing the amount of effort expended to sample vegetation and set up the plot by revising the plot design. 

**The alternative:** We use the 12.6m circular plot with just four vegetation sampling quadrats at 10 meters. Tick traps would be placed near the outside edge of the plot in each of the cardinal directions (north, east, south, west), and one in plot center.

**The caveats:** 1. Tick trap deployment and vegetation measurements would have to be on different days. 2. We still need to do transects for dung surveys.

My first step was to see how this plays out in the data by testing for differences in means of data summarized across all quadrats (12) to data from the quadrats at 10 meters (4). I subset the data and conducted a series of t-test on the means (averaging across all the 1 meter quadrats in each data set) of woody vegetation height, herbaceous vegetation height, litter depth; and percent covers of bare ground, green vegetation, and litter. 


```{r compare all 12 quadrats to subset of 4 at 10m }
par(mfrow=c(1,2))
hist(log(quadrat_summaries$avg_woody_ht1))
hist(log(quadrat10m_summaries$avg_woody_ht1))
t.test(log(quadrat_summaries$avg_woody_ht1),log(quadrat10m_summaries$avg_woody_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_woody_ht_all))
var(log(quadrat_summaries$avg_woody_ht_all))
hist(log(quadrat10m_summaries$avg_woody_ht_all))
var(log(quadrat10m_summaries$avg_woody_ht_all))
t.test(log(quadrat_summaries$avg_woody_ht_all),log(quadrat10m_summaries$avg_woody_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht1))
var(log(quadrat_summaries$avg_herb_ht1))
hist(log(quadrat10m_summaries$avg_herb_ht1))
var(log(quadrat10m_summaries$avg_herb_ht1))
t.test(log(quadrat_summaries$avg_herb_ht1),
       log(quadrat10m_summaries$avg_herb_ht1), var.equal = F)

hist(log(quadrat_summaries$avg_herb_ht_all))
var(log(quadrat_summaries$avg_herb_ht_all))
hist(log(quadrat10m_summaries$avg_herb_ht_all))
var(log(quadrat10m_summaries$avg_herb_ht_all))
t.test(log(quadrat_summaries$avg_herb_ht_all),
       log(quadrat10m_summaries$avg_herb_ht_all), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth1))
var(log(quadrat_summaries$avg_litter_depth1))
hist(log(quadrat10m_summaries$avg_litter_depth1))
var(log(quadrat10m_summaries$avg_litter_depth1))
t.test(log(quadrat_summaries$avg_litter_depth1),
       log(quadrat10m_summaries$avg_litter_depth1), var.equal = F)

hist(log(quadrat_summaries$avg_litter_depth_all))
var(log(quadrat_summaries$avg_litter_depth_all))
hist(log(quadrat10m_summaries$avg_litter_depth_all))
var(log(quadrat10m_summaries$avg_litter_depth_all))
t.test(log(quadrat_summaries$avg_litter_depth_all),
       log(quadrat10m_summaries$avg_litter_depth_all), var.equal = T)

hist((quadrat_summaries$avg_pct_green))
var((quadrat_summaries$avg_pct_green))
hist((quadrat10m_summaries$avg_pct_green))
var((quadrat10m_summaries$avg_pct_green))
t.test((quadrat_summaries$avg_pct_green),
       (quadrat10m_summaries$avg_pct_green), var.equal = F)

hist(log(quadrat_summaries$avg_pct_litter))
var(log(quadrat_summaries$avg_pct_litter))
hist(log(quadrat10m_summaries$avg_pct_litter))
var(log(quadrat10m_summaries$avg_pct_litter))
t.test(log(quadrat_summaries$avg_pct_litter),
       log(quadrat10m_summaries$avg_pct_litter), var.equal = F)

hist(log1p(quadrat_summaries$avg_pct_bare))
var((quadrat_summaries$avg_pct_bare))
hist(log1p(quadrat10m_summaries$avg_pct_bare))
var((quadrat10m_summaries$avg_pct_bare))
t.test(log1p(quadrat_summaries$avg_pct_bare),
       log1p(quadrat10m_summaries$avg_pct_bare), var.equal = F)
```

Using all 12 qudrats we have `r n_distinct(species_data$veg_id)` species, while using the four quadrats at 10 meters we have `r n_distinct(species_sub$veg_id)` species. This suggests a major difference in species richness, however, some of these are as yet unidentified/grouped and are likely duplicates for both data sets. 

```{r t-test species cover quadrat subset}
## Testing for differences in dense vs. less dense data collection
hist(log(species_data$pct_cover))
var(log(species_data$pct_cover))
hist(log(species_sub$pct_cover))
var(log(species_sub$pct_cover))
t.test(log(species_data$pct_cover), log(species_sub$pct_cover),
       var.equal = T, paired = F)
```
A t-test of the log-transformed means for percent cover indicate no statistical difference.

Based on these t-tests there were no statistical differences in the means of these variables aggregated to the plot level. 
