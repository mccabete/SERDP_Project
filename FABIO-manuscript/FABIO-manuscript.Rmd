---
title: Experimental methodology for testing effects of variation in naturally structured fine fuel loads on fire intensity
author:
- affilnum: 1
  email: wdillon@ufl.edu/whalendillon@gmail.com
  name: Whalen W. Dillon
- affilnum: 1
  name: Drew T. Hiatt
- affilnum: 1
  name: S. Luke Flory
affiliation:
- affil: Agronomy Department, University of Florida, Gainesville, FL, 32611, USA
  affilnum: 1
# - affil: null
#   affilnum: 2
# - affil: null
#   affilnum: 3
output: 
  pdf_document:
    fig_caption: yes
    # fig_height:
    fig_width: 7.5
    includes:
      in_header: header.tex
    keep_tex: yes
    number_sections: no
    template: manuscript.latex
  html_document: null
  word_document: null
capsize: normalsize
classoption: a4paper
csl: ecology.csl
documentclass: article
fontsize: 11pt
footerdate: yes
geometry: margin=1in
linenumbers: yes
bibliography:
      - knitcitations.bib
      - references.bib
spacing: doublespacing
abstract: no
---


```{r setup, include=FALSE, cache=FALSE, message = FALSE}
library(knitr); library(plyr); library(dplyr); library(readr); library(ggplot2)

#opts_knit$set(root.dir=normalizePath('../'))

### Chunk options: see http://yihui.name/knitr/options/ ###

## Text results
opts_chunk$set(echo = F, warning = F, message = F, include = TRUE)

## Code decoration
opts_chunk$set(tidy = TRUE, comment = NA, highlight = TRUE)

## Cache
opts_chunk$set(cache = 2, cache.path = "cache/")

## Plots
opts_chunk$set(fig.path = "figures/")
opts_chunk$set(dpi = 1200)
opts_chunk$set(dev = c("png"))

```


```{r knitcitations, cache = F}

library(knitcitations)
cleanbib()   
cite_options(citation_format = "pandoc")
library(bibtex)
library(RefManageR)

```

\singlespace

\vspace{2mm}\hrule

Write your abstract here.

\vspace{3mm}\hrule

*Keywords*: fine fuels, fire intensity, fuel load, fuel structure

\doublespace

\bleft


# INTRODUCTION

Fine surface fuels play a major role in the ignition, spread, and intensity of fires. The influence of fuels on fire is determined by fuel charateristics, including load, moisture, compactness, continuity, and structure. 

      - more exposed to atmosphere
 
      - coupled to changing ambient conditions
 
Fuel characteristics, such as load (mass), structure, type, moisture, particle size, drive fire intensity and severity.

We strive to understand how fuel characteristics influence fire intensity, severity, and behavior. Methods range from *in situ* approaches where measurements are made before, during, and after prescribed fires, to laboratory bench approaches where small amounts of fuel are combusted in highly controlled settings. 

Studies in fire ecology that experimentally manipulate fuel characteristics often only change the fuel load and/or type of fuel, necessarily sacrificing some realism in fuel structure.

      - still provding valuable data

## Other experimental fire ecology studies

[@Bowman2017] *Differential demographic filtering by surface fires: How fuel type and fuel load affect sapling mortality of an obligate seeder savanna tree.*

In this study, "Grass fuels had to be laid horizontally rather than standing vertically." The context provided is that the native sorghum grass flattens easily after it dries and does not remain vertical throughout the dry season. 

- This reads like a response to a reviewer comment, which might indicate a gap that the FABIO methodology can fill. 

- Average flame height was measured "when the fire was within 15cm of the tree stem using a metal grid placed verically against a steel picket placed next to the stem."

Additional references given where fuels have been laid flat when testing flammability:

 - `r citep("Jaureguiberry 2011 Austral Ecology")`

      - Built the "Bar-B-Q"" apparatus to fill a need to quantify flammability of whole plants of many species
    
      - Quantified flammability characteristics of 34 species using "whole plant"
    
      - Fuels are still burnt horizontally, so no vertical structure
    
      - Length of fuel limited by size of burning surface

 - `r citep("Simpson 2016 Journal of Ecology")`

 - `r citep("Wyse 2016 International Journal of Wildland Fire")`

All of these studies assessed flammability of multiple species, or multiple fuel complexes.

3. We present a methodology for maintaining realism in fuel structure in experiments where fine fuels with typical vertical structure, e.g. grasses, are manipulated.

4. We demonstrate how the Fine Aboveground Biomass Incineration Organizer (FABIO) can maintain realistic fuel structure while experimentally manipulating fuel load and density. Using the exotic invasive cogongrass, we illustrate how changing the fuel structure can substantially alter flammability characteristics. 

It can be deployed in the field or in a more controlled "laboratory" setting. 


Temperature metrics are influenced by fuel structure. In general, fuels with greater vertical arrangement will achieve higher maximum temperatures, but will also burn faster. Faster burning should result in less exposure above temperature thresholds that cause tissue damage to plants. We show these differences in maximum temperature and time above 100 ÂºC for standing and piled fuels.


# METHODS

## Fine Aboveground Biomass Incineration Organizer (FABIO)

![](figures/FABIOdraft.jpg)


## Study Area

We harvested ~50 kg of standing cogongrass from an invasion at the Biven's Arm Research Station (BARS), Florida, USA. The fuel was stored in a shed for 48-hours to protect it from rainfall, and then spread outside in a cleared area to dry for ~72 hours. We raked through the pile each day to increase drying, while carefully maintaining stem orientation in the same direction. We found that consistent stem orientation was more efficient for weighing and loading fuels vertically into the FABIO. 


## Data collection and analysis

Our experimental design was to conduct three burns for each of five fuel loads (250 g, 500 g, 1000 g, 1500 g, 2000 g) spanning the range of cogongrass biomass observed from field measurements across Florida, USA. 


```{r load data from FABIO experiment, results='hide'}

# source("~/Documents/SERDP_Project/fire-temps.R")
# source("~/Documents/SERDP_Project/fire-weather-data.R")

fires_biomass <- read_csv("~/Documents/SERDP_Project/data/fabio-fires-biomass.csv")
fires_biomass <- filter(fires_biomass, date > "2017-11-30")
summary(fires_biomass)
fires_biomass <- fires_biomass %>% 
      select(date, fire_id, biomass, structure:max_fuel_ht, avg_fuel_ht) %>% 
      mutate(f_structure = as.factor(structure),
             rate_of_spread_ms = )




fire_temps <- read_csv("~/Documents/SERDP_Project/data/fabio-fires-temperatures.csv")
fire_temps <- filter(fire_temps, date > "2017-11-30") %>% select(-probe_type)
fire_temps <- left_join(
      fire_temps,
      select(fires_biomass, fire_id, structure, biomass),
      by = "fire_id"
                        )
      
# average the temperature across each vertical level "location"
fire_temps_avg <- fire_temps %>% 
      group_by(date, time, biomass, location, structure, fire_id) %>% 
      summarise(tempC = mean(tempC)) %>% 
      arrange(fire_id)
# write_csv(fire_temps_avg, "~/Documents/SERDP_Project/data/piled-vs-stand-avg-fire-temps.csv")

time_abv100 <- fire_temps_avg %>%
      group_by(location, structure, fire_id) %>%
      filter(tempC>100) %>%
      summarise(s_abv100 = length(tempC),
                heat_flux_abv100 = sum(tempC)) %>%
      ungroup(.)

# d1$flame_ht2 <- as.integer(d1$flame_ht2)
max_temp <- fire_temps_avg %>%
      group_by(location, structure, fire_id) %>%
      summarise(max_temp = max(tempC)) %>% 
      ungroup(.)

# average the top five highest temperatures at each height
avg_max_temp <- fire_temps_avg %>% 
      group_by(location, structure, fire_id) %>% 
      arrange(desc(tempC)) %>% 
      summarise(avg2_max_temp = mean(tempC[1:5])) %>% 
      ungroup(.)


fabio_fires <- join_all(list(max_temp, avg_max_temp, time_abv100), 
               type = "full", match = "all")

summary(fabio_fires)
fabio_fires$s_abv100[is.na(fabio_fires$s_abv100)] <- 0
fabio_fires$heat_flux_abv100[is.na(fabio_fires$heat_flux_abv100)] <- 0

fabio_fires <- left_join(fabio_fires, fires_biomass) %>% 
      mutate(location = as.factor(location),
             structure = as.factor(structure),
             # struc_indicator = as.factor(ifelse(structure=="piled", 0, 1)),
             f_biomass = as.factor(biomass))

fire_weather_summary <- read_csv(
      "~/Documents/SERDP_Project/data/piled-vs-standing-fire-wx-summary.csv"
      )
fabio_fires <- left_join(fabio_fires,fire_weather_summary)

# write_csv(fabio_fires, "~/Documents/SERDP_Project/data/piled-vs-stand-aggregate.csv")

fabio_fires_summary <- fabio_fires %>%
      group_by(location, structure, biomass) %>%
      summarise(n_obs = length(location),
                avg_s_abv100 = mean(s_abv100),
                se_s_abv100 = sd(s_abv100)/sqrt(n_obs),
                avg_heat_flux_abv100 = mean(heat_flux_abv100),
                se_heat_flux_abv100 = sd(heat_flux_abv100)/sqrt(n_obs),
                avg_max_temp = mean(max_temp),
                se_max_temp = sd(max_temp)/sqrt(n_obs),
                avg2_max_temp_avg = mean(avg2_max_temp),
                se_avg2_max_temp = sd(avg2_max_temp)/sqrt(n_obs)
                )
# write_csv(fabio_fires_summary, "~/Documents/SERDP_Project/data/piled-vs-stand-summary.csv")

fabio_fireid_summary <- fabio_fires %>%
      group_by(location, structure, biomass, fire_id) %>%
      summarise(n_obs = length(location),
                avg_s_abv100 = mean(s_abv100),
                # se_s_abv100 = sd(s_abv100)/sqrt(n_obs),
                avg_heat_flux_abv100 = mean(heat_flux_abv100),
                # se_heat_flux_abv100 = sd(heat_flux_abv100)/sqrt(n_obs),
                avg_max_temp = mean(max_temp),
                # se_max_temp = sd(max_temp)/sqrt(n_obs),
                avg2_max_temp_avg = mean(avg2_max_temp)
                # se_avg2_max_temp = sd(avg2_max_temp)/sqrt(n_obs)
                )

fire_weather_summary <- read_csv(
      "~/Documents/SERDP_Project/data/piled-vs-standing-fire-wx-summary.csv"
      )
fabio_fireid_summary <- left_join(
      select(fabio_fireid_summary, -n_obs), 
      select(fire_weather_summary, -date, -n_obs))

fabio_fireid_summary_0cm_piled <- ungroup(fabio_fireid_summary) %>% 
      filter(location=="0cm", structure=="piled") %>% 
      select(biomass, starts_with("avg"))


fires_biomass <- left_join(
      fires_biomass, 
      select(fire_weather_summary, fire_id, starts_with("avg")))

```

```{r Table1 fire-weather-table, results='asis'}

# fires_biomass
fire_wx_table <- left_join(
      select(fire_weather_summary, -n_obs),
      select(fires_biomass, fire_id, biomass, structure)
             ) %>% 
      arrange(fire_id) %>%
      mutate(avg_air_temp = round(avg_air_temp, 2),
             se_air_temp = round(se_air_temp, 2),
             avg_rh = round(avg_rh, 2),
             se_rh = round(se_rh, 2),
             avg_wind_speed = round(avg_wind_speed, 2),
             se_wind_speed = round(se_wind_speed, 2),
             air_temp_avg_se = paste(avg_air_temp, " Â± ", se_air_temp),
             rh_avg_se = paste(avg_rh, " Â± ", se_rh),
             wind_speed_avg_se = paste(avg_wind_speed, " Â± ", se_wind_speed)) %>% 
      select(fire_id, date, structure, biomass, air_temp_avg_se:wind_speed_avg_se)

wxtable_col_names <- c("Fire ID", "Date", "Structure", "Biomass", "Air temperature (ÂºC)", "RH (%)", "Wind Speed (m s^-1^)")

wxtable <- knitr::kable(
      fire_wx_table, col.names = wxtable_col_names, align = 'c',
      caption = "Summary of weather for each fire (means Â± SE). Fire IDs 54, 56, 70, & 74 were assigned values from their paired fires 53, 55, 69, & 73 due to missing data.")
wxtable

# xtable::xtable(fire_wx_table)

```

```{r pairs-panel-fxns}
panel.cor <- function(x, y, digits = 2, cex.cor, ...)
{
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(0, 1, 0, 1))
  # correlation coefficient
  r <- (cor(x, y))
  txt <- format(c(r, 0.123456789), digits = digits)[1]
  txt <- paste("r= ", txt, sep = "")
  if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
  text(0.5, 0.5, txt, cex = cex.cor * abs(r))


  # p-value calculation
  # p <- cor.test(x, y)$p.value
  # txt2 <- format(c(p, 0.123456789), digits = digits)[1]
  # txt2 <- paste("p= ", txt2, sep = "")
  # if(p<0.01) txt2 <- paste("p= ", "<0.01", sep = "")
  # text(0.5, 0.4, txt2)
}

panel.hist <- function(x, ...)
{
      usr <- par("usr"); on.exit(par(usr))
      par(usr = c(usr[1:2], 0, 1.5) )
      h <- hist(x, plot = FALSE)
      breaks <- h$breaks; nB <- length(breaks)
      y <- h$counts; y <- y/max(y)
      rect(breaks[-nB], 0, breaks[-1], y, col = "cyan", ...)
}
```

```{r explore model data, eval=F}

model_data <- select(fabio_fires, max_temp, s_abv100, heat_flux_abv100, avg_flame_ht, max_flame_ht, rate_of_spread_50cm, biomass, structure, location, pct_fuel_moisture, avg_air_temp, avg_rh, avg_wind_speed)

pairs(model_data, lower.panel = panel.cor, diag.panel = panel.hist,
      main = "All Levels of Temperature")

pairs(filter(model_data, location == "0cm"), main = "Ground Level",
      lower.panel = panel.cor, diag.panel = panel.hist)

model_data2 <- select(fires_biomass, rate_of_spread_50cm, pct_consumed, max_flame_ht, avg_flame_ht, biomass, f_structure, pct_fuel_moisture, max_fuel_ht:avg_wind_speed)

pairs(model_data2, lower.panel = panel.cor, diag.panel = panel.hist,
      main = "Aggregate Fire Data")

```


```{r eval=F}

ggplot(fire_temps_avg, aes(time, tempC)) +
      geom_line(aes(color = structure)) +
      facet_grid(biomass~location) +
      theme_bw()

```


### Linear models of maximum temperature

```{r compare_maxtemp}

# bowman_maxtemp <- read_csv("~/Documents/SERDP_Project/data/bowman-etal-maxtemp.csv")
# bowman_maxtemp$source <- "Piled (Bowman et al.)"
# 
# # names(bowman_maxtemp)
# bowman_maxtemp <- filter(bowman_maxtemp, biomass_type == "grass")
# fabio_maxtemp <- fabio_burns %>% 
#       filter(litter_biomass == 0, biomass_type == "cogongrass", pct_green == 25, standing_biomass < 2000) %>% 
#       select(standing_biomass, max_temp, location, biomass_type, source) %>% 
#       rename(biomass = standing_biomass, tempC = max_temp)
# 
# maxtemp_df <- rbind(bowman_maxtemp,fabio_maxtemp)
# maxtemp_df <- maxtemp_df %>% 
#       filter(location != "25cm")
# # unique(maxtemp_df$location)
# maxtemp_df$location[maxtemp_df$location!="50cm"] <- "near ground"

# maxtemp <- ggplot(fabio_fires, aes(biomass, max_temp)) +
#       # geom_line(aes(color = location, linetype = structure)) +
#       geom_point(aes(color = structure)) +
#       facet_grid(.~location) +
#       # scale_shape_manual(values = 21) +
#       scale_color_discrete(h.start = 20) +
#       theme_bw()
# maxtemp +
#       xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
#       ylab("Maximum Temperature ÂºC") +
#       theme(legend.title = element_blank(), 
#             # legend.direction = "vertical",
#             # legend.position = c(.02,.98),
#             legend.justification = c("left","top"),
#             legend.spacing = unit(x = -.3, units = "cm"),
#             axis.title = element_text(size = 16),
#             axis.text = element_text(size = 12),
#             plot.margin = unit(c(.5,.5,.5,.5), "cm")
#             )
fabio_fires_summary$structure <- stringr::str_to_title(fabio_fires_summary$structure)
avg_max_temp_plot <- ggplot(fabio_fires_summary, aes(biomass, avg_max_temp)) +
      # scale_color_discrete(h.start = 20) +
      scale_color_grey(start = .3, end = .8) +
      facet_grid(.~location) +
      # geom_bar(stat = "identity", fill = "grey60") +
      # scale_fill_continuous(low = "yellow", high = "red") +
      geom_errorbar(aes(ymin = avg_max_temp + se_max_temp, 
                        ymax = avg_max_temp - se_max_temp),
                    width = .1) +
      # geom_line(aes(color = structure, linetype = structure)) +
      geom_smooth(aes(color = structure, linetype = structure), method = "lm",
                  se = F, size = .8) +
      geom_point(aes(color = structure, shape = structure), size = 2) +
      # facet_grid(location~.) +
      ylab("Maximum Temperature") +
      xlab("Fuel Load (g)") +
      theme_bw() +
      # theme_classic() +
      theme(legend.title = element_blank(),
            legend.text = element_text(size = 12),
            legend.position = c(.92, .1),
            legend.background = element_blank(),
            strip.background = element_blank(),
            panel.grid = element_blank(),
            axis.title = element_text(size = 14)
            # panel.border = element_blank(),
            # panel.background = element_blank(),
            # axis.line = element_line(colour = "black")
            )
avg_max_temp_plot

# maxtemp_avg <- ggplot(fabio_fires, aes(biomass, avg2_max_temp)) +
#       # geom_line(aes(color = location, linetype = structure)) +
#       geom_point(aes(color = structure)) +
#       facet_grid(location~.) +
#       # scale_shape_manual(values = 21) +
#       scale_color_discrete(h.start = 20) +
#       theme_bw() +
#       xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
#       ylab("Average Max Temperature ÂºC") +
#       theme(legend.title = element_blank(), 
#             # legend.direction = "vertical",
#             # legend.position = c(.02,.98),
#             legend.justification = c("left","top"),
#             legend.spacing = unit(x = -.3, units = "cm"),
#             axis.title = element_text(size = 16),
#             axis.text = element_text(size = 12),
#             plot.margin = unit(c(.5,.5,.5,.5), "cm")
#             )
# maxtemp_avg

# ggplot(fabio_fires_summary, aes(biomass, avg2_max_temp_avg)) +
#       geom_point(aes(shape = structure), size = 2) +
#       scale_color_discrete(h.start = 20) +
#       facet_grid(.~location) +
#       # geom_bar(stat = "identity", fill = "grey60") +
#       # scale_fill_continuous(low = "yellow", high = "red") +
#       geom_errorbar(aes(ymin = avg2_max_temp_avg + se_avg2_max_temp, 
#                         ymax = avg2_max_temp_avg - se_avg2_max_temp),
#                     width = .1) +
#       # facet_grid(location~.) +
#       ylab("Average Max Temperature") +
#       xlab("Fuel Load (g)") +
#       theme_bw()

```      

```{r maxtemp_linear_models}

max_temp_lm_full <- glm(max_temp ~ biomass + biomass:structure + biomass:location + structure:location + avg_air_temp + pct_fuel_moisture, 
                  data = fabio_fires, na.action = "na.fail")
# summary(max_temp_lm_full)

options(na.action = "na.fail")
library(MuMIn)
dd <- dredge(max_temp_lm_full, extra = c("R^2"))
# filter(dd, delta < 10)

my_row_names <- c("(Intercept)", "Biomass", "Structure: standing")

fabio_fires_0cm <- filter(fabio_fires, location == "0cm")
max_temp_0cm <- lm(max_temp ~ biomass*structure, data = fabio_fires_0cm)
dredge(max_temp_0cm, extra = c("R^2"))
coef0cm <- as.data.frame(summary(max_temp_0cm)$coefficients)
rownames(coef0cm) <- my_row_names
kable(coef0cm, digits = 3, caption = "Max temperature at ground level")

fabio_fires_25cm <- filter(fabio_fires, location == "25cm")
max_temp_25cm <- lm(max_temp ~ biomass*structure, data = fabio_fires_25cm)
dredge(max_temp_25cm, extra = c("R^2"))
coef25cm <- as.data.frame(summary(max_temp_25cm)$coefficients)
rownames(coef25cm) <- my_row_names
kable(coef25cm, digits = 3, caption = "Max temperature at 25cm")

fabio_fires_50cm <- filter(fabio_fires, location == "50cm")
max_temp_50cm <- lm(max_temp ~ biomass*structure, data = fabio_fires_50cm)
dredge(max_temp_50cm, extra = c("R^2"))
coef50cm <-  as.data.frame(summary(max_temp_50cm)$coefficients)
rownames(coef50cm) <- my_row_names
kable(coef50cm, digits = 3, caption = "Max temperature at 50cm")

```


### Linear models of time above 100 ÂºC

```{r compare_secsAbv100 }

# bowman_s_abv100 <- read_csv("~/Documents/SERDP_Project/data/bowman-etal-s_abv100.csv")
# bowman_s_abv100$source <- "Piled (Bowman et al.)"
# 
# # names(bowman_s_abv100)
# bowman_s_abv100 <- filter(bowman_s_abv100, biomass_type == "grass")
# fabio_s_abv100 <- fabio_burns %>% 
#       filter(litter_biomass == 0, biomass_type == "cogongrass", pct_green == 25, standing_biomass < 2000) %>% 
#       select(standing_biomass, s_abv100, location, biomass_type, source) %>% 
#       rename(biomass = standing_biomass)
# 
# s_abv100_df <- rbind(bowman_s_abv100, fabio_s_abv100)
# s_abv100_df <- s_abv100_df %>% 
#       filter(location != "25cm")
# # unique(s_abv100_df$location)
# s_abv100_df$location[s_abv100_df$location!="50cm"] <- "near ground"

s_abv100 <- ggplot(fabio_fires, aes(biomass, s_abv100)) +
      # geom_line(aes(color = source, linetype = location)) +
      geom_smooth(aes(color = structure, linetype = structure), method = "lm", se = T, size = .8) +
      geom_point(aes(color = structure)) +
      scale_color_grey(start = .2, end = .8) +
      facet_grid(.~location) +
      # scale_shape_manual(values = 21) +
      theme_bw() +
      xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
      ylab("Seconds above 100 ÂºC") +
      theme(legend.title = element_blank(),
            legend.text = element_text(size = 12),
            legend.position = c(.92, .9),
            legend.background = element_blank(),
            strip.background = element_blank(),
            panel.grid = element_blank(),
            axis.title = element_text(size = 14)
            )

s_abv100_avg_plot <- ggplot(fabio_fires_summary, aes(biomass, avg_s_abv100)) +
      # scale_color_discrete(h.start = 20) +
      scale_color_grey(start = .3, end = .8) +
      # scale_color_brewer(palette = "Set1") +
      facet_grid(.~location) +
      # geom_bar(stat = "identity", fill = "grey60") +
      # scale_fill_continuous(low = "yellow", high = "red") +
      geom_errorbar(aes(ymin = avg_s_abv100 + se_s_abv100, 
                        ymax = avg_s_abv100 - se_s_abv100),
                    width = .1) +
      geom_smooth(aes(color = structure, linetype = structure), method = "lm", se = F, size = .8) +
      geom_point(aes(color = structure, shape = structure), size = 2) +
      # facet_grid(location~.) +
      ylab("Seconds >100 ÂºC") +
      xlab("Fuel Load (g)") +
      theme_bw() +
      theme(legend.title = element_blank(),
            legend.text = element_text(size = 12),
            legend.position = c(.92, .9),
            legend.background = element_blank(),
            strip.background = element_blank(),
            panel.grid = element_blank(),
            axis.title = element_text(size = 14)
            )
s_abv100_avg_plot

```

```{r s_abv100_linear_models}

s_abv100_lm <- lm(log1p(s_abv100) ~ biomass + biomass*structure + biomass*location + structure*location + avg_air_temp + avg_rh + pct_fuel_moisture + avg_wind_speed, 
                  data = fabio_fires, na.action = na.fail)
# summary(s_abv100_lm)

dd <- dredge(update(s_abv100_lm, .~. -avg_air_temp -avg_rh -pct_fuel_moisture), extra = c("adjR^2"))
# filter(dd, delta < 10)


s_abv100_0cm <- lm(s_abv100 ~ (biomass) + structure, data = filter(fabio_fires, location == "0cm"))
coef0cm <- as.data.frame(summary(s_abv100_0cm)$coefficients)
rownames(coef0cm) <- my_row_names
kable(coef0cm, digits = 3, caption = "Time above 100 ÂºC (seconds) at ground level")

s_abv100_25cm <- lm(s_abv100 ~ (biomass) + structure, data = filter(fabio_fires, location == "25cm"))
coef25cm <- as.data.frame(summary(s_abv100_25cm)$coefficients)
rownames(coef25cm) <- my_row_names
kable(coef25cm, digits = 3, caption = "Time above 100 ÂºC (seconds) at 25cm")

s_abv100_50cm <- lm(s_abv100 ~ (biomass) + structure, data = filter(fabio_fires, location == "50cm"))
coef50cm <- as.data.frame(summary(s_abv100_50cm)$coefficients)
rownames(coef50cm) <- my_row_names
kable(coef50cm, digits = 3, caption = "Time above 100 ÂºC (seconds) at 50cm")

```


```{r compare_heatFlux_abv100, eval=F}
flux_abv100 <- ggplot(fabio_fires, aes(biomass, heat_flux_abv100)) +
      # geom_line(aes(color = source, linetype = location)) +
      geom_point(aes(color = structure)) +
      scale_color_discrete(h.start = 20) +
      facet_grid(location~.) +
      # scale_shape_manual(values = 21) +
      theme_bw()
flux_abv100 +
      xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
      ylab("Flux above 100 ÂºC") +
      theme(legend.title = element_blank(), 
            # legend.direction = "vertical",
            # legend.position = c(.02,.98),
            legend.justification = c("left","top"),
            legend.spacing = unit(x = -.3, units = "cm"),
            axis.title = element_text(size = 16),
            axis.text = element_text(size = 12),
            plot.margin = unit(c(.5,.5,.5,.5), "cm")
            )

ggplot(fabio_fires_summary, aes(biomass, avg_heat_flux_abv100)) +
      geom_point(aes(shape = structure), size = 2) +
      scale_color_discrete(h.start = 20) +
      facet_grid(location~.) +
      # geom_bar(stat = "identity", fill = "grey60") +
      # scale_fill_continuous(low = "yellow", high = "red") +
      geom_errorbar(aes(ymin = avg_heat_flux_abv100 + se_heat_flux_abv100, 
                        ymax = avg_heat_flux_abv100 - se_heat_flux_abv100),
                    width = .1) +
      # facet_grid(location~.) +
      ylab("Flux >100 ÂºC") +
      xlab("Fuel Load (g)") +
      theme_bw()

```


### Linear models of flame height

```{r compare flame height}

# bowman_flame_ht <- read_csv("~/Documents/SERDP_Project/data/bowman-etal-flame-height.csv")
# bowman_flame_ht$source <- "Piled (Bowman et al.)"
# 
# bowman_flame_ht <- filter(bowman_flame_ht, biomass_type == "grass")
# fabio_flame_ht <- fabio_burns %>% 
#       filter(litter_biomass == 0, biomass_type == "cogongrass", 
#              pct_green == 25, standing_biomass < 2000, max_flame_ht != -Inf,
#              location == "0cm") %>% 
#       select(standing_biomass, max_flame_ht, biomass_type, source) %>%
#       rename(biomass = standing_biomass)
# 
# max_flame_ht_df <- rbind(bowman_flame_ht, fabio_flame_ht)

piled_fires <- filter(fires_biomass, structure=="piled")
# pairs(select(piled_fires, biomass, rate_of_spread_50cm, pct_consumed:avg_wind_speed),
#       lower.panel = panel.cor, diag.panel = panel.hist)

ggplot(fires_biomass, aes(biomass, max_flame_ht)) +
      # geom_line(aes(color = structure)) +
      geom_point(aes(color = structure), size = 3) +
      geom_smooth(aes(color = structure), method = "lm") +
      scale_color_discrete(h.start = 20) +
      theme_bw() +
      xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
      ylab("Max flame height (cm)") +
      theme(legend.title = element_blank(), 
            # legend.direction = "vertical",
            legend.position = c(.02,.98),
            legend.justification = c("left","top"),
            legend.spacing = unit(x = -.3, units = "cm"),
            axis.title = element_text(size = 16),
            axis.text = element_text(size = 12),
            plot.margin = unit(c(.5,.5,.5,.5), "cm")
            )

ggplot(fires_biomass, aes(biomass, avg_flame_ht, color = structure)) +
      geom_point(aes(color = structure), size = 3) +
      geom_smooth(aes(color = structure), method = "lm") +
      scale_color_discrete(h.start = 20) +
      theme_bw() +
      xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
      ylab("Average flame height (cm)") +
      theme(legend.title = element_blank(), 
            # legend.direction = "vertical",
            legend.position = c(.02,.98),
            legend.justification = c("left","top"),
            legend.spacing = unit(x = -.3, units = "cm"),
            axis.title = element_text(size = 16),
            axis.text = element_text(size = 12),
            plot.margin = unit(c(.5,.5,.5,.5), "cm")
            )


# d1 <- pile_vs_stand
# d1$biomass[d1$fire_id==59|d1$fire_id==60] <- 1200
# 
# a <- ggplot(pile_vs_stand, aes(biomass, avg_fuel_ht, color = structure)) +
#       geom_point(aes(color = structure), size = 3) +
#       scale_color_discrete(h.start = 20) +
#       theme_bw() +
#       ggtitle("Kept at 1500g")
# b <- ggplot(d1, aes(biomass, avg_fuel_ht, color = structure)) +
#       geom_point(aes(color = structure), size = 3) +
#       scale_color_discrete(h.start = 20) +
#       theme_bw() +
#       ggtitle("Changed to 1000g")
# 
# c <- xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
#       # ylab("Average fuel height (cm)") +
#       theme(legend.title = element_blank(), 
#             # legend.direction = "vertical",
#             # legend.position = c(.02,.98),
#             legend.justification = c("left","top"),
#             legend.spacing = unit(x = -.3, units = "cm"),
#             axis.title = element_text(size = 16),
#             axis.text = element_text(size = 12),
#             plot.margin = unit(c(.5,.5,.5,.5), "cm")
#             )
# 
# a1 <- a + c 
# a2 <- b + c
# 
# library(cowplot)
# plot_grid(a1, a2)

```


### Linear models of biomass consumed
```{r compare biomass consumption}

# ggplot(pile_vs_stand, aes(biomass, remaining_biomass, color = structure)) +
#       geom_point(size = 2, position = "jitter") +
#       scale_color_discrete(h.start = 20) +
#       theme_bw()

ggplot(fires_biomass, aes(biomass, pct_consumed)) +
      # geom_line(aes(color = structure)) +
      geom_point(aes(color = structure), size = 3) +
      scale_color_discrete(h.start = 20) +
      theme_bw() +
      xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
      ylab("Percent consumed") +
      theme(legend.title = element_blank(), 
            # legend.direction = "vertical",
            legend.position = c(.8,.4),
            legend.justification = c("left","top"),
            legend.spacing = unit(x = -.3, units = "cm"),
            axis.title = element_text(size = 16),
            axis.text = element_text(size = 12),
            plot.margin = unit(c(.5,.5,.5,.5), "cm")
            )

# ggplot(pile_vs_stand, aes(biomass, pct_consumed, color = structure)) +
#       geom_point(size = 2) +
#       scale_color_discrete(h.start = 20) +
#       theme_bw()

```


```{r rate_of_spread}

# Analyze rate of spread with zeroes and with zeroes excluded as NA.

## convert rate of spread to m/s

# View(filter(fires_biomass, rate_of_spread_50cm>62, structure=="standing"))
ggplot(fires_biomass, aes(biomass, rate_of_spread_50cm, color = structure)) +
      theme_bw() +
      xlab(expression(paste("Fuel load (g/", m^{2}, ")"))) +
      ylab("Rate of spread (s/50cm)") +
      geom_smooth(aes(color = structure, linetype = structure), method = "lm") +
      geom_point(size = 3) +
      scale_color_discrete(h.start = 20) +
      theme(legend.title = element_blank(), 
            # legend.direction = "vertical",
            # legend.position = c(.02,.98),
            legend.justification = c("left","top"),
            legend.spacing = unit(x = -.3, units = "cm"),
            axis.title = element_text(size = 16),
            axis.text = element_text(size = 12),
            plot.margin = unit(c(.5,.5,.5,.5), "cm")
            )

```



We applied a linear model where

$$
y_{i} = \alpha + \beta_{1}*x_{i} + \beta_{2} 
$$

```{r model, echo = FALSE, eval = FALSE}
model <- lm(y ~ x)
```

We used the statistical language `R` `r citep(citation())` for all our analyses. These were implemented in dynamic rmarkdown documents using `knitr` `r citep(citation("knitr"))` and `rmarkdown` `r citep(citation("rmarkdown"))` packages. All the multilevel models were fitted with `lme4` `r citep(citation("lme4"))`. 



# RESULTS

Trees in forest A grew taller than those in forest B (mean height: `r mean(25, 31, 28)` versus `r mean(13, 19, 16)` m). And many more cool results that get updated dynamically.




# DISCUSSION

Discuss.



# CONCLUSIONS



# ACKNOWLEDGEMENTS



# REFERENCES

```{r write_citations, cache=FALSE, include=FALSE}
write.bibtex(file="knitcitations.bib")
```

<div id = "refs"></div>


\eleft

\clearpage


\listoftables


\newpage

```{r Table1, results='asis', echo=FALSE, cache=FALSE}
kable(head(iris), caption = "A glimpse of the famous *Iris* dataset.")
```


\newpage



\clearpage

\listoffigures


\newpage

![Figure 1](figures/Fig2_3panel.pdf)
\newpage


\newpage

![](figures/timeandmaxtempPanels2x2.pdf)

\newpage

\blandscape

```{r Fig2, echo=FALSE, fig.cap="Second figure in landscape format.", cache=FALSE}
a <- sort(rnorm(100))
b <- c(rep("Group Small", 35), rep("Group Big", 65))
boxplot(a ~ b)
```

\elandscape

\clearpage



```{r sessioninfo, echo = FALSE, eval = FALSE}
# set eval = FALSE if you don't want this info (useful for reproducibility) to appear 
sessionInfo()
```

